/**  
 * 个人工具库 => jUtilsBase 
 * @QQ 1174295440
 * @author Bestime
 * @see https://github.com/bestime/tool
 * @update 2023-10-21 15:38:49
 */
function isNull(e){return null===e||e===undefined}function _String(e){return isNull(e)?"":String(e)}var $ArrayTypeNameBig="Array",$FunctionTypeNameBig="Function",$ObjectTypeNameBig="Object",$stringTypeNameBig="String",$numberTypeNameBig="Number",$undefinedValue=void 0,$zeroString="0",$falseString="false",$trueString="true",$ObjectTypeNameBigPrototypeToString=Object.prototype.toString,$encodeURI=encodeURI,$decodeURIComponent=decodeURIComponent,$regSpaceStr="\\s\\uFEFF\\xA0",$isBroswer="undefined"!=typeof document&&document.getElementById!==undefined,$browserGlobal="undefined"!=typeof window?window:$undefinedValue;function getType(e){return $ObjectTypeNameBigPrototypeToString.call(e).slice(8,-1)}function isArray(e){return getType(e)===$ArrayTypeNameBig}function isKvPair(e){return getType(e)===$ObjectTypeNameBig}function hpJsonParse(e,n){var r;try{r=JSON.parse(e)}catch(t){r=n}return r}function _KvPair(e){return e=isKvPair(e)||isKvPair(e=hpJsonParse(e))?e:{}}function isEmpty(e){return isNull(e)||""===e}function isFunction(e){return"function"==typeof e}function param(e){var r=[];function i(e,n){null!=e&&""!==e&&(n=null==(n=isFunction(n)?n():n)?"":n,r[r.length]=$encodeURI(e)+"="+$encodeURI(n))}return function a(e,n){var r,t;if(e)switch(getType(n)){case $ArrayTypeNameBig:for(r=0;r<n.length;r++)a(e+"["+("object"==typeof n[r]&&n[r]?r:"")+"]",n[r]);break;case $ObjectTypeNameBig:for(t in n)a(e+"["+t+"]",n[t]);break;default:i(e,n)}else switch(getType(n)){case $stringTypeNameBig:case $ObjectTypeNameBig:for(t in n)a(t,n[t]);break;case $ArrayTypeNameBig:for(r=0;r<n.length;r++)i(n[r].name,n[r].value)}}("",e),r.join("&")}function urlToGet(e,n){e=_String(e).replace(/&*$/g,"").replace(/\?*$/,"");var r="";return(r=isKvPair(n)||isArray(n)?param(n):_String(n).replace(/^&*/,""))&&(e+=(/\?/.test(e)?"&":"?")+r),e}$isBroswer?document.getElementsByTagName("head")[0]:undefined;var baseReg="["+$regSpaceStr+"]+";function trim(e,n){var r=getType(e),t=(r===$numberTypeNameBig&&(e=String(e),r=$stringTypeNameBig),"");if(r!==$stringTypeNameBig)return"";switch(n){case 1:t="^"+baseReg;break;case-1:t=baseReg+"$";break;case"*":t=baseReg;break;default:t="^"+baseReg+"|"+baseReg+"$"}return e.replace(new RegExp(t,"g"),"")}function isString(e){return getType(e)===$stringTypeNameBig}function hpIsEmptyMap(e){var n,r=!0;for(n in e)if(n!==undefined){r=!1;break}return r}function clean(e,n,r){if(r=!1!==r,isKvPair(e)){var t,i,a={};for(i in e)_filterData(isArray(t=e[i])||isKvPair(t)?clean(t,n):t,n,r,function(e){a[i]=e})}else if(isArray(e)){a=[];for(var o=0,s=e.length;o<s;o++)_filterData(clean(e[o],n),n,r,function(e){a.push(e)})}else a=e;return a}function _filterData(e,n,r,t){isString(e)?n&&""==trim(e,"*")||t(e):null!=e&&(r&&isKvPair(e)&&hpIsEmptyMap(e),t(e))}function cloneEasy(e){switch(getType(e)){case $ArrayTypeNameBig:for(var n=[],r=0;r<e.length;r++)n.push(cloneEasy(e[r]));break;case $ObjectTypeNameBig:for(var t in n={},e)n[t]=cloneEasy(e[t]);break;case $FunctionTypeNameBig:function i(){e.apply(this,arguments)}for(var a in e.prototype)i.prototype[a]=e.prototype[a];n=i;break;default:n=e}return n}function isNoData(e,n){var r=!1;return r=isArray(e)&&n.array&&0===e.length||isKvPair(e)&&n.kvPair&&hpIsEmptyMap(e)||isString(e)&&n.string&&""===e||isNull(e)?!0:r}function hander(e,n){if(isKvPair(e))for(var r in e){var t=e[r];(isArray(t)||isKvPair(t))&&hander(t,n),isNoData(t,n)&&delete e[r]}}function shake(e,n){n=Object.assign({string:!0,array:!0,kvPair:!0},n);return hander(e=cloneEasy(e),n),e}function _Array(e){return e=isArray(e)||isArray(e=hpJsonParse(e))?e:[]}function variableHasValue(e,n,r){var t;r=null==r?60:r,e()?n():(clearTimeout(t),setTimeout(function(){variableHasValue(e,n,r)},r))}variableHasValue["async"]=function(n,r){return new Promise(function(e){variableHasValue(n,e,r)})};var DEFAULT_CONFIG={id:"id",children:"children"};function deepFindTreePath(e,n,r){r=Object.assign(DEFAULT_CONFIG,r);for(var t=[],i=cloneEasy(e),a=new Set,o=r["children"];i.length;){var s=i[0];if(a.has(s))t.pop(),i.shift();else if(a.add(s),s[o]&&i.unshift.apply(i,s[o]),t.push(s),n(s))return t}return undefined}function _Number(e){return(e=Number(e))===Math.abs(Infinity)||isNaN(e)?0:e}function defaultValue(e,n){return isNull(e)?n:e}function repeatString(e,n){var r="";if((e=_String(e)).length*n<1<<28)for(;1==(1&n)&&(r+=e),0!=(n>>>=1);)e+=e;return r}function hpPadString(e,n,r,t){return(e=_String(e)).length>(n>>=0)?e:(n-=e.length,r.length<n&&(r+=repeatString(r,n/r.length)),-1===t?r.slice(0,n)+e:e+r.slice(0,n))}function padStart(e,n,r){return hpPadString(e,n,r,-1)}function padEnd(e,n,r){return hpPadString(e,n,r,1)}function split(e,n){return""!==e?e.split(n):[]}function floorFixed(e,n,r){var e=split(e=trim(_Number(e)),"."),t=e[1]||"";return t.length<n&&(t=padEnd(t,n,$zeroString),r&&(t=t.replace(/0+$/,""))),n<1||!t?e[0]:e[0]+"."+t.substring(0,n)}function roundFixed(e,n,r){e=_Number(e);var t,i=Math.pow(10,n),e=_String(Math.round(e*i)/i);return 0<n&&(t=(i=split(e,"."))[0],(i=i[1]||"").length<n&&(i=padEnd(i,n,$zeroString),e=(i=r?i.replace(/0+$/,""):i)?t+"."+i:t)),e}function deepFindItem(e,r,n){var t,i,a=isNull(n)?"children":n;return function o(e){if(e)for(var n=0;n<e.length;n++){if(i=r(e[n])){t=e[n];break}if(o(e[n][a]),i)break}}(e),t}function flatArrayToTree(e,n){for(var r=(n=_KvPair(n)).id||"id",t=n.pid||"pid",i=n.children||"children",a=0;a<e.length;a++){var o,s=e[a];(o=deepFindItem(e,function(e){return null!=e[r]&&e[r]!=s[r]&&e[r]===s[t]},i))&&(o[i]=_Array(o[i]),o[i].push(s),e.splice(a--,1))}return e}function changeIndex(e,n,r){if(e<0)return n;e+=1;return(n=(n+r)%e)<0&&(n+=e),-0===n?0:n}function getRandom(e,n,r){r=!1===r?0:1;return e=Math.random()*(n-e+r)+e,r?Math.floor(e):e}function _Boolean(e){return!0===e||"true"===e||"1"===e||1===e}function flatTree(e,t){var i=[];return t=defaultValue(t,"children"),function a(e){if(isArray(e))for(var n,r=0;r<e.length;r++)n=e[r],i.push(n),a(n[t])}(e),i}function main(e,t,i,a){a=a||"children";var n=[];return function o(e,n){for(var r=0;r<e.length;r++)n[r]=cloneEasy(i(e[r])),e[r][a]&&(n[r][t]=[],o(e[r][a],n[r][t]))}(e,n),n}var events={};function defineEventBus(i){if(events[i])throw'"'+i+'" Has already been registered!';return events[i]=events[i]||[],{on:function(e){events[i].push(e)},emit:function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];for(var t=0;t<events[i].length;t++)events[i][t].apply($undefinedValue,n)},off:function(e){if(!e)throw"the hander of off is required!";for(var n=0;n<events[i].length;n++)events[i][n]===e&&events[i].splice(n--,1)},dispose:function(){for(var e=0;e<events[i].length;e++)events[i].splice(e--,1);delete events[i]}}}function forEachTree(e,r,t){t=t||"children",function i(e){for(var n=0;n<e.length;n++)r(e[n]),isArray(e[n][t])&&i(e[n][t])}(e)}function randomColor(){return"rgba("+getRandom(0,255,!0)+","+getRandom(0,255,!0)+","+getRandom(0,255,!0)+",1)"}function emptyFunc(e,n){}var Polling=function(){function e(e){this._timer=void 0,this._timer_info=void 0,this._stamp=0,this._passStamp=0,this._option=void 0,this._option=Object.assign({timeout:6e3,interval:1e3,handler:emptyFunc},e),this._next=this._next.bind(this),this._doOnce=this._doOnce.bind(this),this.done=this.done.bind(this)}var n=e.prototype;return n._next=function(){return clearInterval(this._timer),this._passStamp=+new Date-this._stamp,this._timer=setTimeout(this._doOnce,this._option.interval),this},n._doOnce=function(){if(this._passStamp>=this._option.timeout)return this._option.onMessage&&this._option.onMessage(0),this.done(),this;this._option.handler(this._next,this.done)},n.start=function(){var e,n=this;this._stamp=+new Date,this.done(),this._doOnce();return this._option.onMessage&&(clearInterval(this._timer_info),this._timer_info=setInterval(function(){e=+new Date-n._stamp,0===(e=Math.max(n._option.timeout-e,0))&&n.done(),n._option.onMessage(e)},100)),this},n.done=function(){return clearTimeout(this._timer),clearTimeout(this._timer_info),this},n.dispose=function(){return this.done(),this},e}();function hpTryToParseStringToBasicType(e){return null==e?undefined:$falseString!==e&&($trueString===e||hpJsonParse(e,e))}var defaultSplitArr=[$undefinedValue,$undefinedValue];function handleDeepKey(e,n,r){var n=splitSymbol(n),t=n[0];isPreLikeArray(t)?(t=_Number(t),n[1]==$undefinedValue?e.push(r):(/^\[[\D]+\]/.test(n[1])?e[t]=_KvPair(e[t]):e[t]=_Array(e[t]),handleDeepKey(e[t],n[1],r))):n[1]==$undefinedValue?e[t]=r:(/^\[[\D]+\]/.test(n[1])?e[t]=_KvPair(e[t]):e[t]=_Array(e[t]),handleDeepKey(e[t],n[1],r))}function splitSymbol(e){if(e==$undefinedValue)return defaultSplitArr;var t,i=e;return e.replace(/^\[(.*?)\](.*)?/,function(e,n,r){return i=n,t=r,""}),[i,t]}function isPreLikeArray(e){return""===e||/^\d+$/.test(e)}function parseQuery(e){var a,r,o={};return(e=e||$isBroswer&&$browserGlobal.location.href||"").replace(/([^=&?/#]*?)=([^=&?/#]*)/g,function(e,n,i){i=hpTryToParseStringToBasicType($decodeURIComponent(i)),r=$decodeURIComponent(n),a=!1,""!==r&&(r.replace(/(.*?)(\[.*)/,function(e,n,r){var t=splitSymbol(r);a=!0,isPreLikeArray(t[0])?o[n]=_Array(o[n]):o[n]=_KvPair(o[n]),handleDeepKey(o[n],r,i)}),a||(o[r]=i))}),o}export{Polling,_Array,_Boolean,_KvPair,_Number,_String,changeIndex,clean,cloneEasy,deepFindItem,deepFindTreePath,defaultValue,defineEventBus,flatTree,floorFixed,forEachTree,getRandom,getType,isArray,isEmpty,isFunction,isKvPair,isNull,main as mapTree,padEnd,padStart,param,parseQuery,randomColor,repeatString,roundFixed,shake,split,flatArrayToTree as tree,trim,urlToGet,variableHasValue};
