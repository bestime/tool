/**
 * 纯JS工具库 => jUtilsBase 
 * 可在浏览器、nodejs、小程序中使用
 * @QQ 1174295440
 * @see https://github.com/bestime/tool 分支：base
 * @update 2024-04-03 17:49:33
 */
!function(n,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((n="undefined"!=typeof globalThis?globalThis:n||self).jUtilsBase={})}(this,function(n){"use strict";var e=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"],o="Array",u="Object",f="String",P="Number",v=void 0,L="false",q="true",A=Object.prototype.toString,r=encodeURI,i=decodeURIComponent;function c(n){return null===n||n===v}function s(n){return c(n)?"":String(n)}function l(n){return A.call(n).slice(8,-1)}function h(n){return l(n)===o}function d(n){return l(n)===u}function a(n){return l(n)===f}function p(n,e){var t;try{t=JSON.parse(n)}catch(r){t=e}return t}function m(n){return n=d(n)||d(n=p(n))?n:{}}function g(n){return c(n)||""===n}function b(n){return"function"==typeof n}function t(n){var t=[];function i(n,e){null!=n&&""!==n&&(e=null==(e=b(e)?e():e)?"":e,t[t.length]=r(n)+"="+r(e))}return function a(n,e){var t,r;if(n)switch(l(e)){case o:for(t=0;t<e.length;t++)a(n+"["+("object"==typeof e[t]&&e[t]?t:"")+"]",e[t]);break;case u:for(r in e)a(n+"["+r+"]",e[r]);break;default:i(n,e)}else switch(l(e)){case f:case u:for(r in e)a(r,e[r]);break;case o:for(t=0;t<e.length;t++)i(e[t].name,e[t].value)}}("",n),t.join("&")}function y(n){return n=h(n)||h(n=p(n))?n:[]}function _(n){return n=Number(n),Math.abs(n)===Math.abs(Infinity)||isNaN(n)?0:n}var D=[v,v];function w(n){if(n==v)return D;var r,i=n;return n.replace(/^\[(.*?)\](.*)?/,function(n,e,t){return i=e,r=t,""}),[i,r]}function S(n){return""===n||/^\d+$/.test(n)}function k(n){var o={},u=!1,r="";return(n=c(n)?"":n).replace(/([^=&?/#]*?)=([^=&?/#]*)/g,function(n,e,a){var t;t=i(a),a=null==t?v:L!==t&&(q===t||p(t,t)),r=i(e),u=!1,""!==r&&(r.replace(/(.*?)(\[.*)/,function(n,e,t){var r=w(t);u=!0,S(r[0])?o[e]=y(o[e]):o[e]=m(o[e]),function i(n,e,t){var e=w(e),r=e[0];S(r)?(r=_(r),e[1]==v?n.push(t):(/^\[[\D]+\]/.test(e[1])?n[r]=m(n[r]):n[r]=y(n[r]),i(n[r],e[1],t))):e[1]==v?n[r]=t:(/^\[[\D]+\]/.test(e[1])?n[r]=m(n[r]):n[r]=y(n[r]),i(n[r],e[1],t))}(o[e],t,a)}),u||(o[r]=a))}),o}var E="[\\s\\uFEFF\\xA0]+";function N(n,e){var t=l(n),r=(t===P&&(n=String(n),t=f),"");if(t!==f)return"";switch(e){case 1:r="^"+E;break;case-1:r=E+"$";break;case"*":r=E;break;default:r="^"+E+"|"+E+"$"}return n.replace(new RegExp(r,"g"),"")}function x(n){switch(l(n)){case o:for(var e=[],t=0;t<n.length;t++)e.push(x(n[t]));break;case u:for(var r in e={},n)e[r]=x(n[r]);break;case"Function":function i(){n.apply(this,arguments)}for(var a in n.prototype)i.prototype[a]=n.prototype[a];e=i;break;default:e=n}return e}function B(n,e){var t=!1;return t=h(n)&&e.array&&0===n.length||d(n)&&e.kvPair&&function(n){var e,t=!0;for(e in n)if(e!==v){t=!1;break}return t}(n)||a(n)&&e.string&&""===n||c(n)?!0:t}function F(n,e,t){var r;t=null==t?60:t,n()?e():(clearTimeout(r),setTimeout(function(){F(n,e,t)},t))}F["async"]=function(e,t){return new Promise(function(n){F(e,n,t)})};var U={id:"id",children:"children"};function T(n){var e=!1;return"boolean"==typeof n||h(n)||null==n||""===n||(n=Number(n),e=!isNaN(n)&&Infinity!=Math.abs(n)),e}function Z(n,e){return c(n)?e:n}function K(n,e){var t="";if((n=s(n)).length*e<1<<28)for(;1==(1&e)&&(t+=n),0!=(e>>>=1);)n+=n;return t}function V(n,e,t,r){return(n=s(n)).length>(e>>=0)?n:(e-=n.length,t.length<e&&(t+=K(t,e/t.length)),-1===r?t.slice(0,e)+n:n+t.slice(0,e))}function M(n,e,t){return V(n,e,t,1)}function R(n,e){return""!==n?n.split(e):[]}function z(n,t,e){var r,i,a=c(e)?"children":e;return function o(n){if(n)for(var e=0;e<n.length;e++){if(i=t(n[e])){r=n[e];break}if(o(n[e][a]),i)break}}(n),r}function $(n,e,t){t=!1===t?0:1;return n=Math.random()*(e-n+t)+n,t?Math.floor(n):n}function j(){return e[$(0,e.length-1)][0]}var C={};function H(n,e){}function G(n,e,t,r){if(n="【"+n+"】",t&&g(e))throw"字段"+n+"不能为空";if(l(e)!==r)switch(r){case"String":e=String(e);break;case"Number":if(!T(e))throw"字段"+n+"必须为数字";e=Number(e)}return e}var J={number:function(n,e){return G(n,e,!(2<arguments.length&&arguments[2]!==undefined)||arguments[2],"Number")},string:function(n,e){return G(n,e,2<arguments.length&&arguments[2]!==undefined&&arguments[2],"String")}};function I(n){return Array.from(new Set(n))}var Q=function(n,e){return Number(n)-Number(e)},W=0,O={};function X(n,e){var t=[],r=[];return n.forEach(function(n){n=e[n],O[n]||(O[n]={id:++W,label:n});n=O[n];t.push(n.id),r.push(n.label)}),{id:t.join("_"),label:r.join("→")}}function Y(n,e){return n===v||e===v?v:(e-n)/n}n.Polling=function(){function n(n){this._timer=void 0,this._timer_info=void 0,this._stamp=0,this._passStamp=0,this._option=void 0,this._option=Object.assign({timeout:6e3,interval:1e3,handler:H},n),this._next=this._next.bind(this),this._doOnce=this._doOnce.bind(this),this.done=this.done.bind(this)}var e=n.prototype;return e._next=function(){return clearInterval(this._timer),this._passStamp=+new Date-this._stamp,this._timer=setTimeout(this._doOnce,this._option.interval),this},e._doOnce=function(){if(this._passStamp>=this._option.timeout)return this._option.onMessage&&this._option.onMessage(0),this.done(),this;this._option.handler(this._next,this.done)},e.start=function(){var n,e=this;this._stamp=+new Date,this.done(),this._doOnce();return this._option.onMessage&&(clearInterval(this._timer_info),this._timer_info=setInterval(function(){n=+new Date-e._stamp,0===(n=Math.max(e._option.timeout-n,0))&&e.done(),e._option.onMessage(n)},100)),this},e.done=function(){return clearTimeout(this._timer),clearTimeout(this._timer_info),this},e.dispose=function(){return this.done(),this},n}(),n._Array=y,n._Boolean=function(n){return!0===n||"true"===n||"1"===n||1===n},n._KvPair=m,n._Number=_,n._String=s,n.arrayRowToColumn=function(n,i){var e,t=[],a=(n.forEach(function(n){n=String(n[i.colField]);t.includes(n)||t.push(n)}),t.sort(null!=(f=i.colSort)?f:Q),{}),l=(n.forEach(function(e){var n=X(i.uniqueRowId,e),t={},r=(i.uniqueRowId.forEach(function(n){t[n]=e[n]}),a[n.id]=a[n.id]||{value:t,name:n.label,data:{}},i.colCreate(e[i.colField]).field);a[n.id].data[r]=a[n.id].data[r]||[],a[n.id].data[r].push(e)}),[]);for(e in a)l.push({name:a[e].name,value:a[e].value,data:a[e].data,summary:{}});var o,u,r,f=t.map(function(n){var e=i.colCreate(n);return{value:n,label:e.label,field:e.field}}),h={};return i.summaryConfig&&(i.summaryConfig.row&&(o=l,u=i.summaryConfig.row,r=i.summaryConfig.averageField,o.forEach(function(f){var c=u[f.name];if(c){var s,n,l=0,h=0;for(n in f.data)!function(n){h++;var e,t=[],r=0,i=[],a=[],o=(f.data[n].forEach(function(n){t.push(n[c.count.field]);var e=_(n[c.value.field]);switch(c.value.mode){case"uniqLength":i.push(n[c.value.field]),i=I(i),r=i.length;break;case"sum":case"avg":r+=e}0!==e&&a.push(e)}),0);switch(c.count.mode){case"length":o=t.length;break;case"uniqLength":o=I(t).length;break;case"notZeroValue":o=a.length}var u=r;"avg"===c.value.mode&&(u=r/o),l+=u,f.summary[n]={value:u,proportion:0,riseRatio:s?Y(null==(e=f.summary[s])?void 0:e.value,u):void 0},s=n}(n);f.summary[r]={value:l/h,riseRatio:v,proportion:0}}}),o.forEach(function(n){var e=u[n.name];if(e){var t=o.find(function(n){return n.name===e.proportionBaseField});if(e.proportionBaseField&&t)for(var r in n.summary)n.summary[r].proportion=n.summary[r].value/t.summary[r].value}}),l=o),i.summaryConfig.column&&(h=function(c,s,l){var n,h={},d={},e=function(i){d[i]={},h[i]={};var n,a=s[i],e=(c.forEach(function(r){for(var n in r.data)!function(n){h[i][n]=h[i][n]||{data:[],sum:0};var e=[],t=0;switch(r.data[n].forEach(function(n){switch(e.push(n[a.field]),a.mode){case"uniqLength":e=I(e);break;case"avg":case"sum":t+=n[a.field];break;case"notZeroLength":0!==_(n[a.field])&&t++}}),a.mode){case"uniqLength":e=I(e);break;case"avg":t/=r.data[n].length}h[i][n].data=h[i][n].data.concat(e),h[i][n].sum+=t}(n)}),void 0);for(n in h[i]){var t,r=0;switch(a.mode){case"avg":r=h[i][n].sum/c.length;break;case"uniqLength":r=h[i][n].data.length/c.length;break;case"notZeroLength":case"sum":r=h[i][n].sum}d[i][n]={value:r,proportion:0,riseRatio:e?Y(null==(t=d[i][e])?void 0:t.value,r):void 0},e=n}var o,u=0,f=0;for(o in d[i])u+=d[i][o].value,f++;d[i][l]={value:u/f,riseRatio:v,proportion:0}};for(n in s)e(n);return d}(l,i.summaryConfig.column,i.summaryConfig.averageField))),{columns:f,data:l,colSummary:h,getExtRow:function(e,n,t){var r,i=l.find(function(n){return n.name===e}),a={};if(!i){var o=n,u=t,f=h[e],c={};if(f)for(var s in f)c[s]=u(f[s][o]);return c}for(r in i.summary)a[r]=t(i.summary[r][n]);return a}}},n.changeIndex=function(n,e,t){return n<0?e:((e=(e+t)%(n+=1))<0&&(e+=n),-0===e?0:e)},n.cloneEasy=x,n.dataPage=function(n,e,t){if(t<1)throw"页码必须大于0";var r=(t-1)*e,i=r+e;return{current:t,total:n.length,size:e,pages:Math.ceil(n.length/e),data:x(n.slice(r,i))}},n.deepFindItem=z,n.deepFindTreePath=function(n,e,t){t=Object.assign(U,t);for(var r=[],i=x(n),a=new Set,o=t["children"];i.length;){var u=i[0];if(a.has(u))r.pop(),i.shift();else if(a.add(u),u[o]&&i.unshift.apply(i,u[o]),r.push(u),e(u))return r}return undefined},n.defaultValue=Z,n.defineEventBus=function(i){if(C[i])throw'"'+i+'" Has already been registered!';return C[i]=C[i]||[],{on:function(n){C[i].push(n)},emit:function(){for(var n=arguments.length,e=new Array(n),t=0;t<n;t++)e[t]=arguments[t];for(var r=0;r<C[i].length;r++)C[i][r].apply(v,e)},off:function(n){if(!n)throw"the hander of off is required!";for(var e=0;e<C[i].length;e++)C[i][e]===n&&C[i].splice(e--,1)},dispose:function(){for(var n=0;n<C[i].length;n++)C[i].splice(n--,1);delete C[i]}}},n.fieldCheck=J,n.flatTree=function(n,r){var i=[];return r=Z(r,"children"),function a(n){if(h(n))for(var e,t=0;t<n.length;t++)e=n[t],i.push(e),a(e[r])}(n),i},n.floorFixed=function(n,e,t){var r=(n=R(n=N(_(n)),"."))[1]||"";return r.length<e&&(r=M(r,e,"0"),t&&(r=r.replace(/0+$/,""))),e<1||!r?n[0]:n[0]+"."+r.substring(0,e)},n.forEach=function(n,e){for(var t=0;t<n.length;t++)e(n[t],t,n)},n.forEachTree=function(n,i,a){a=a||"children",function o(n,e){for(var t=0;t<n.length;t++){var r=x(e);i(n[t],r),h(n[t][a])&&(r.push(n[t]),o(n[t][a],r))}}(n,[])},n.getRandom=$,n.getType=l,n.isArray=h,n.isEmpty=g,n.isFunction=b,n.isFuzzyMatch=function(n,e,t){var r=!0;return(n=N(n,"*"))&&(n=R(n,"").join(".*"),r=new RegExp(n,s(t)).test(e)),r},n.isKvPair=d,n.isLikeNumber=T,n.isNull=c,n.isString=a,n.mapKvPair=function(n,e){var t,r={};for(t in n)r[t]=e(x(n[t]),t);return r},n.mapTree=function(n,r,i,a){a=a||"children";var e=[];return function o(n,e){for(var t=0;t<n.length;t++)e[t]=x(i(n[t])),n[t][a]&&(e[t][r]=[],o(n[t][a],e[t][r]))}(n,e),e},n.mixInZeroWidthUnicode=function(n){return R(n,"").join("‎")},n.padEnd=M,n.padStart=function(n,e,t){return V(n,e,t,-1)},n.param=t,n.parseQuery=k,n.randomColor=function(){return"rgba("+$(0,255,!0)+","+$(0,255,!0)+","+$(0,255,!0)+",1)"},n.repeatString=K,n.roundFixed=function(n,e,t){n=_(n);var r,i=Math.pow(10,e),n=s(Math.round(n*i)/i);return 0<e&&(r=(i=R(n,"."))[0],(i=i[1]||"").length<e&&(i=M(i,e,"0"),n=(i=t?i.replace(/0+$/,""):i)?r+"."+i:r)),n},n.shake=function(n,e){return e=Object.assign({string:!0,array:!0,kvPair:!0},e),function i(n,e){if(d(n))for(var t in n){var r=n[t];(h(r)||d(r))&&i(r,e),B(r,e)&&delete n[t]}}(n=x(n),e),n},n.spanTable=function(n,i){var u=x(n),f={};function t(i,a){var o=0;u.forEach(function(n,e){n.$rowSpan=null!=(r=n.$rowSpan)?r:{};var t,r=n[i];f[i]=null!=(t=f[i])?t:0,1<f[i]?(n.$rowSpan[i]=0,f[i]--):(t=function(n,e,t,r){var i=1;for(n++;n<r.length;n++){var a=r[n][e];if(a!==t&&!g(a))break;i++}return i}(e,i,r,u),void 0!==a&&(r=function(n,e,t){for(var r=0;0<=e&&!(0<(r=n[e].$rowSpan[t]));e--);return r}(u,e,a),0<o?r<=o+t?(t=r-o,o=0):o+=t:t<r?o=t:t=r),f[i]=t,n.$rowSpan[i]=f[i])})}return i.forEach(function(n,e){t(n,i[e-1])}),u.forEach(function(t){t.$colSpan={};var r=0;i.forEach(function(n,e){n=t[n];1<r?(t.$colSpan[e]=0,r--):(r=function(n,e,t,r){var i=1;for(n++;n<r.length;n++){var a=N(t[r[n]]);if(a!==e&&!g(a))break;i++}return i}(e,n,t,i),t.$colSpan[e]=r)})}),u},n.split=R,n.thousands=function(n,i,a){return i=i||3,a=a||",",s(n).replace(/([^.]*)?(\.)?(.*)?/,function(n,e,t,r){return s(e).replace(new RegExp("(.(?=(.{"+i+"})+$))","g"),"$1"+a)+s(t)+s(r)})},n.tree=function(n,e){for(var t=(e=m(e)).id||"id",r=e.pid||"pid",i=e.children||"children",a=0;a<n.length;a++){var o,u=n[a];(o=z(n,function(n){return null!=n[t]&&n[t]!=u[t]&&n[t]===u[r]},i))&&(o[i]=y(o[i]),o[i].push(u),n.splice(a--,1))}return n},n.trim=N,n.urlToGet=function(n,e){n=s(n);var a=d(e)?e:k(e),e=k(n=n.replace(/({{)(.*?)(}})/g,function(n,e,t,r){t=N(t);var i=a[t];return delete a[t],i})),e=t(a=Object.assign(e,a));return n=e?(n=n.replace(/\?.*/,""))+"?"+e:n},n.uuid=function(n){n=_(n);for(var e="",t=0;t<13;t++)e+=$(1,9);return n=(new Date).getTime()*$(1,100),M(j()+Number(e).toString(32)+n.toString(32),20,j()+j()+j())},n.variableHasValue=F});
