/**
 * 纯JS工具库 => jUtilsBase
 * @update 2024-05-09 10:03:46
 */
!function(n,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((n="undefined"!=typeof globalThis?globalThis:n||self).jUtilsBase={})}(this,function(n){"use strict";var t=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"],o="Array",u="Object",c="String",L="Number",m=void 0,O="false",q="true",V=Object.prototype.toString,e=encodeURI,a=decodeURIComponent;function h(n){return null===n||n===m}function f(n){return h(n)?"":String(n)}function l(n){return V.call(n).slice(8,-1)}function d(n){return l(n)===o}function s(n){return l(n)===u}function v(n){return l(n)===c}function p(n,t){var r;try{r=JSON.parse(n)}catch(e){r=t}return r}function g(n){return n=s(n)||s(n=p(n))?n:{}}function y(n){return h(n)||""===n}function _(n){return"function"==typeof n}function A(n){var r=[];function a(n,t){null!=n&&""!==n&&(t=null==(t=_(t)?t():t)?"":t,r[r.length]=e(n)+"="+e(t))}return function i(n,t){var r,e;if(n)switch(l(t)){case o:for(r=0;r<t.length;r++)i(n+"["+("object"==typeof t[r]&&t[r]?r:"")+"]",t[r]);break;case u:for(e in t)i(n+"["+e+"]",t[e]);break;default:a(n,t)}else switch(l(t)){case c:case u:for(e in t)i(e,t[e]);break;case o:for(r=0;r<t.length;r++)a(t[r].name,t[r].value)}}("",n),r.join("&")}function b(n){return n=d(n)||d(n=p(n))?n:[]}function w(n){return n=Number(n),Math.abs(n)===Math.abs(Infinity)||isNaN(n)?0:n}var D=[m,m];function B(n){if(n==m)return D;var e,a=n;return n.replace(/^\[(.*?)\](.*)?/,function(n,t,r){return a=t,e=r,""}),[a,e]}function K(n){return""===n||/^\d+$/.test(n)}function r(n){var o={},u=!1,e="";return(n=h(n)?"":n).replace(/([^=&?/#]*?)=([^=&?/#]*)/g,function(n,t,i){var r;r=a(i),i=null==r?m:O!==r&&(q===r||p(r,r)),e=a(t),u=!1,""!==e&&(e.replace(/(.*?)(\[.*)/,function(n,t,r){var e=B(r);u=!0,K(e[0])?o[t]=b(o[t]):o[t]=g(o[t]),function a(n,t,r){var t=B(t),e=t[0];K(e)?(e=w(e),t[1]==m?n.push(r):(/^\[[\D]+\]/.test(t[1])?n[e]=g(n[e]):n[e]=b(n[e]),a(n[e],t[1],r))):t[1]==m?n[e]=r:(/^\[[\D]+\]/.test(t[1])?n[e]=g(n[e]):n[e]=b(n[e]),a(n[e],t[1],r))}(o[t],r,i)}),u||(o[e]=i))}),o}var i="[\\s\\uFEFF\\xA0]+";function E(n,t){var r=l(n),e=(r===L&&(n=String(n),r=c),"");if(r!==c)return"";switch(t){case 1:e="^"+i;break;case-1:e=i+"$";break;case"*":e=i;break;default:e="^"+i+"|"+i+"$"}return n.replace(new RegExp(e,"g"),"")}function S(n){switch(l(n)){case o:for(var t=[],r=0;r<n.length;r++)t.push(S(n[r]));break;case u:for(var e in t={},n)t[e]=S(n[e]);break;case"Function":function a(){n.apply(this,arguments)}for(var i in n.prototype)a.prototype[i]=n.prototype[i];t=a;break;default:t=n}return t}function U(n,t){var r=!1;return r=d(n)&&t.array&&0===n.length||s(n)&&t.kvPair&&function(n){var t,r=!0;for(t in n)if(t!==m){r=!1;break}return r}(n)||v(n)&&t.string&&""===n||h(n)?!0:r}function k(n,t,r){var e;r=null==r?60:r,n()?t():(clearTimeout(e),setTimeout(function(){k(n,t,r)},r))}k["async"]=function(t,r){return new Promise(function(n){k(t,n,r)})};var Z={id:"id",children:"children"};function z(n){var t=!1;return"boolean"==typeof n||d(n)||null==n||""===n||(n=Number(n),t=!isNaN(n)&&Infinity!=Math.abs(n)),t}function R(n,t){return h(n)?t:n}function G(n,t){var r="";if((n=f(n)).length*t<1<<28)for(;1==(1&t)&&(r+=n),0!=(t>>>=1);)n+=n;return r}function H(n,t,r,e){return(n=f(n)).length>(t>>=0)?n:(t-=n.length,r.length<t&&(r+=G(r,t/r.length)),-1===e?r.slice(0,t)+n:n+r.slice(0,t))}function T(n,t,r){return H(n,t,r,1)}function C(n,t){return""!==n?n.split(t):[]}function x(n,r,t){var e,a,i=h(t)?"children":t;return function o(n){if(n)for(var t=0;t<n.length;t++){if(a=r(n[t])){e=n[t];break}if(o(n[t][i]),a)break}}(n),e}function P(n,t,r){r=!1===r?0:1;return n=Math.random()*(t-n+r)+n,r?Math.floor(n):n}function F(){return t[P(0,t.length-1)][0]}var N={};function W(n,t){}function J(n,t,r,e){if(n="【"+n+"】",r&&y(t))throw"字段"+n+"不能为空";if(l(t)!==e)switch(e){case"String":t=String(t);break;case"Number":if(!z(t))throw"字段"+n+"必须为数字";t=Number(t)}return t}var Q={number:function(n,t){return J(n,t,!(2<arguments.length&&arguments[2]!==undefined)||arguments[2],"Number")},string:function(n,t){return J(n,t,2<arguments.length&&arguments[2]!==undefined&&arguments[2],"String")}};function I(n){return Array.from(new Set(n))}var X=function(n,t){return Number(n)-Number(t)},Y=0,M={};function nn(n,t){var r=[],e=[];return n.forEach(function(n){n=t[n],M[n]||(M[n]={id:++Y,label:n});n=M[n];r.push(n.id),e.push(n.label)}),{id:r.join("_"),label:e.join("→")}}function tn(n,t){return n===m||t===m?m:(t-n)/n}function j(n,t){var r,e={},a=-1;for(r in n)a++,e[r]=t(n[r],r,a);return e}function $(n,t){return 0===t?1:0===n||h(n)?0:n/t}var rn="sys-row-avg";function en(n,t){var u={},r=t.colField;if(!h(r)&&n.length){var a=t.cellSummary;if(n.forEach(function(n){var t=n[r];u[t]=u[t]||{data:[],summary:0,_collect:[]},u[t].data.push(n),a&&(n=n[a.numerator[0]],u[t].summary+=n,u[t]._collect.push(n))}),!h(a)){var e,i,o;for(e in u)!function(n){var t=u[n],r=1,e=a.denominator;if(e)switch(e[1]){case"length":r=t.data.map(function(n){return n[e[0]]}).length;break;case"uniqLength":r=I(t.data.map(function(n){return n[e[0]]})).length}switch(a.numerator[1]){case"sum":h(t.summary)||(t.summary=t.summary/r);break;case"length":t.summary=t._collect.length/r;break;case"uniqLength":t.summary=I(t._collect).length/r}}(e);o=i=0,j(u,function(n){i++;n=h(n.summary)?0:n.summary;o+=n}),u[rn]={data:[],summary:o/i,_collect:[]},t.colCustom&&j(t.colCustom,function(n,t){var r=c(n.numerator),n=n.denominator?c(n.denominator):1;u[t]={data:[],summary:$(r,n),_collect:[]}})}}return u;function c(a){var i=0,o=-1;return j(u,function(n,t){var r,e;[rn].includes(t)||"*"!==a[1]&&!a[1].includes(t)||(t=0,o++,h(a[2])||"value"===a[2]?t=h(n.summary)?0:n.summary:"length"===a[2]?(r=a[3])&&(t=n.data.map(function(n){return n[r]}).length):"uniqLength"===a[2]&&(e=a[3])&&(t=I(n.data.map(function(n){return n[e]})).length),"sum"===a[0]?i+=t:"max"===a[0]?i=Math.max(i,t):"diff"===a[0]&&(0===o?i=t:i-=t))}),i}}function an(n,u){var t={},c=0;!function l(n,t,r){for(var e=0;e<t.length;e++){var a=t[e],i=function(n,t){var r=[];return d(n)?n.forEach(function(n){r.push(t[n])}):r.push(t[n]),r.join("→")}(u.path[c].field,a);n[i]=n[i]||{uidPath:r.concat(i),uid:i,data:[],child:{}},n[i].data.push(a)}if(c<u.path.length-1)for(var o in c++,n)l(n[o].child,n[o].data,n[o].uidPath)}(t,n,[]);var n=function s(n,t,r,e){var a,i=[];for(a in n){var o=t===r,u=s(n[a].child,t,r+1,e);i.push({uidPath:n[a].uidPath,uid:n[a].uid,data:n[a].data,_columnRiseRatio:{},_columnTotal:{},_columnProportion:{},_columns:en(n[a].data,e),isLeaf:o,children:u})}return i}(t,c,0,u),e=(!function a(n,t){var r;n.sort(null==(r=u.path[t])?void 0:r.sort),n.forEach(function(n){a(n.children,t+1)})}(n,0),!function i(n){n.forEach(function(n){var r={};j(n._columns,function(n,t){n=h(n.summary)?0:n.summary;r[t]=r[t]||0,r[t]+=n}),n._columnTotal=r,i(n.children)})}(n),{}),f=(n.forEach(function(r){j(r._columns,function(n,t){e[t]=e[t]||0,e[t]+=r._columnTotal[t]})}),[]);return u.colCustom&&j(u.colCustom,function(n,t){n.riseRatio||f.push(t)}),function r(n){var i={},o={};n.forEach(function(n,a){j(n._columns,function(n,t){var r,e;f.includes(t)||(0<a?h(r=n.summary)?o[t]=m:(e=null!=(e=i[t])?e:0,o[t]=$(r-e,e)):o[t]=void 0,i[t]=n.summary)}),n._columnRiseRatio=o,r(n.children)})}(n),function o(n,e){n.forEach(function(n,t){var r={};j(n._columns,function(n,t){r[t]=$(n.summary,e[t])}),n._columnProportion=r,o(n.children,n._columnTotal)})}(n,e),{data:n,total:e}}n.Polling=function(){function n(n){this._timer=void 0,this._timer_info=void 0,this._stamp=0,this._passStamp=0,this._option=void 0,this._option=Object.assign({timeout:6e3,interval:1e3,handler:W},n),this._next=this._next.bind(this),this._doOnce=this._doOnce.bind(this),this.done=this.done.bind(this)}var t=n.prototype;return t._next=function(){return clearInterval(this._timer),this._passStamp=+new Date-this._stamp,this._timer=setTimeout(this._doOnce,this._option.interval),this},t._doOnce=function(){if(this._passStamp>=this._option.timeout)return this._option.onMessage&&this._option.onMessage(0),this.done(),this;this._option.handler(this._next,this.done)},t.start=function(){var n,t=this;this._stamp=+new Date,this.done(),this._doOnce();return this._option.onMessage&&(clearInterval(this._timer_info),this._timer_info=setInterval(function(){n=+new Date-t._stamp,0===(n=Math.max(t._option.timeout-n,0))&&t.done(),t._option.onMessage(n)},100)),this},t.done=function(){return clearTimeout(this._timer),clearTimeout(this._timer_info),this},t.dispose=function(){return this.done(),this},n}(),n._Array=b,n._Boolean=function(n){return!0===n||"true"===n||"1"===n||1===n},n._KvPair=g,n._Number=w,n._String=f,n.arrayRowToColumn=function(n,a){var t,r=[],i=(n.forEach(function(n){n=String(n[a.colField]);r.includes(n)||r.push(n)}),r.sort(null!=(c=a.colSort)?c:X),{}),s=(n.forEach(function(t){var n=nn(a.uniqueRowId,t),r={},e=(a.uniqueRowId.forEach(function(n){r[n]=t[n]}),i[n.id]=i[n.id]||{value:r,name:n.label,data:{}},a.colCreate(t[a.colField]).field);i[n.id].data[e]=i[n.id].data[e]||[],i[n.id].data[e].push(t)}),[]);for(t in i)s.push({name:i[t].name,value:i[t].value,data:i[t].data,summary:{}});var o,u,e,c=r.map(function(n){var t=a.colCreate(n);return{value:n,label:t.label,field:t.field}}),h={};return a.summaryConfig&&(a.summaryConfig.row&&(o=s,u=a.summaryConfig.row,e=a.summaryConfig.averageField,o.forEach(function(c){var f=u[c.name];if(f){var l,n,s=0,h=0;for(n in c.data)!function(n){h++;var t,r=[],e=0,a=[],i=[],o=(c.data[n].forEach(function(n){r.push(n[f.count.field]);var t=w(n[f.value.field]);switch(f.value.mode){case"uniqLength":a.push(n[f.value.field]),a=I(a),e=a.length;break;case"sum":case"avg":e+=t}0!==t&&i.push(t)}),0);switch(f.count.mode){case"length":o=r.length;break;case"uniqLength":o=I(r).length;break;case"notZeroValue":o=i.length}var u=e;"avg"===f.value.mode&&(u=e/o),s+=u,c.summary[n]={value:u,proportion:0,riseRatio:l?tn(null==(t=c.summary[l])?void 0:t.value,u):void 0},l=n}(n);c.summary[e]={value:s/h,riseRatio:m,proportion:0}}}),o.forEach(function(n){var t=u[n.name];if(t){var r=o.find(function(n){return n.name===t.proportionBaseField});if(t.proportionBaseField&&r)for(var e in n.summary)n.summary[e].proportion=n.summary[e].value/r.summary[e].value}}),s=o),a.summaryConfig.column&&(h=function(f,l,s){var n,h={},d={},t=function(a){d[a]={},h[a]={};var n,i=l[a],t=(f.forEach(function(e){for(var n in e.data)!function(n){h[a][n]=h[a][n]||{data:[],sum:0};var t=[],r=0;switch(e.data[n].forEach(function(n){switch(t.push(n[i.field]),i.mode){case"uniqLength":t=I(t);break;case"avg":case"sum":r+=n[i.field];break;case"notZeroLength":0!==w(n[i.field])&&r++}}),i.mode){case"uniqLength":t=I(t);break;case"avg":r/=e.data[n].length}h[a][n].data=h[a][n].data.concat(t),h[a][n].sum+=r}(n)}),void 0);for(n in h[a]){var r,e=0;switch(i.mode){case"avg":e=h[a][n].sum/f.length;break;case"uniqLength":e=h[a][n].data.length;break;case"notZeroLength":case"sum":e=h[a][n].sum}d[a][n]={value:e,proportion:0,riseRatio:t?tn(null==(r=d[a][t])?void 0:r.value,e):void 0},t=n}var o,u=0,c=0;for(o in d[a])u+=d[a][o].value,c++;d[a][s]={value:u/c,riseRatio:m,proportion:0}};for(n in l)t(n);return d}(s,a.summaryConfig.column,a.summaryConfig.averageField))),{columns:c,data:s,colSummary:h,getExtRow:function(t,n,r){var e,a=s.find(function(n){return n.name===t}),i={};if(!a){var o=n,u=r,c=h[t],f={};if(c)for(var l in c)f[l]=u(c[l][o]);return f}for(e in a.summary)i[e]=r(a.summary[e][n]);return i}}},n.changeIndex=function(n,t,r){return n<0?t:((t=(t+r)%(n+=1))<0&&(t+=n),-0===t?0:t)},n.cloneEasy=S,n.dataPage=function(n,t,r){if(r<1)throw"页码必须大于0";var e=(r-1)*t,a=e+t;return{current:r,total:n.length,size:t,pages:Math.ceil(n.length/t),data:S(n.slice(e,a))}},n.deepFindItem=x,n.deepFindTreePath=function(n,t,r){r=Object.assign(Z,r);for(var e=[],a=S(n),i=new Set,o=r["children"];a.length;){var u=a[0];if(i.has(u))e.pop(),a.shift();else if(i.add(u),u[o]&&a.unshift.apply(a,u[o]),e.push(u),t(u))return e}return undefined},n.defaultValue=R,n.defineEventBus=function(a){if(N[a])throw'"'+a+'" Has already been registered!';return N[a]=N[a]||[],{on:function(n){N[a].push(n)},emit:function(){for(var n=arguments.length,t=new Array(n),r=0;r<n;r++)t[r]=arguments[r];for(var e=0;e<N[a].length;e++)N[a][e].apply(m,t)},off:function(n){if(!n)throw"the hander of off is required!";for(var t=0;t<N[a].length;t++)N[a][t]===n&&N[a].splice(t--,1)},dispose:function(){for(var n=0;n<N[a].length;n++)N[a].splice(n--,1);delete N[a]}}},n.fieldCheck=Q,n.flatTree=function(n,e){var a=[];return e=R(e,"children"),function i(n){if(d(n))for(var t,r=0;r<n.length;r++)t=n[r],a.push(t),i(t[e])}(n),a},n.floorFixed=function(n,t,r){var e=(n=C(n=E(w(n)),"."))[1]||"";return e.length<t&&(e=T(e,t,"0"),r&&(e=e.replace(/0+$/,""))),t<1||!e?n[0]:n[0]+"."+e.substring(0,t)},n.forEach=function(n,t){for(var r=0;r<n.length;r++)t(n[r],r,n)},n.forEachKvPair=j,n.forEachTree=function(n,a,i){i=i||"children",function o(n,t){for(var r=0;r<n.length;r++){var e=S(t);a(n[r],e),d(n[r][i])&&(e.push(n[r]),o(n[r][i],e))}}(n,[])},n.getRandom=P,n.getSortIndex=function(n,t){return S(n).sort(t).map(function(t){return n.findIndex(function(n){return t===n})})},n.getType=l,n.isArray=d,n.isEmpty=y,n.isFunction=_,n.isFuzzyMatch=function(n,t,r){var e=!0;return(n=E(n,"*"))&&(n=C(n,"").join(".*"),e=new RegExp(n,f(r)).test(t)),e},n.isKvPair=s,n.isLikeNumber=z,n.isNull=h,n.isString=v,n.listGroup=function(n,t){var l=an(n,t);function i(n,t,r,e,a){var i=x(l.data,function(n){return 0===(r=n.uidPath,e=t,a=function(n,t){return n===t},i=[],r.forEach(function(t){e.some(function(n){return a(n,t)})||i.push(t)}),e.forEach(function(t){r.some(function(n){return a(n,t)})||i.some(function(n){return a(n,t)})||i.push(t)}),i.length);var r,e,a,i}),o=R(a,"");if(i)try{switch(n){case"_columnRiseRatio":case"_columnTotal":case"_columnProportion":var u=i[n][r];return h(u)?o:e(u);default:var c=i[n][r].summary;return h(c)?o:e(c)}}catch(f){return o}return o}function o(n,t,r,e){return i("_columns",n,t,r,e)}function u(n,t,r,e){return i("_columnProportion",n,t,r,e)}return{data:l.data,getCellValue:o,getCellVerticalRiseRatio:function(n,t,r,e){return i("_columnRiseRatio",n,t,r,e)},getCellVerticalTotal:function(n,t,r,e){var a;return"*"===n?h(a=l.total[t])?R(e,""):r(a):i("_columnTotal",n,t,r,e)},getCellVerticalProportion:u,getRowCellValue:function(t,n,r,e){var a={};return n.forEach(function(n){a[n.id]=o(t,n.field,r,e)}),a},getRowVerticalProportion:function(t,n,r,e){var a={};return n.forEach(function(n){a[n.id]=u(t,n.field,r,e)}),a}}},n.mapKvPair=function(n,t){var r,e={};for(r in n)e[r]=t(S(n[r]),r);return e},n.mapTree=function(n,a,i,o){o=o||"children";var t=[];return function u(n,t){for(var r=0;r<n.length;r++){var e=i(n[r]);h(e)||(t[r]=S(e)),n[r][o]&&(t[r][a]=[],u(n[r][o],t[r][a]))}}(n,t),t},n.mixInZeroWidthUnicode=function(n){return C(n,"").join("‎")},n.padEnd=T,n.padStart=function(n,t,r){return H(n,t,r,-1)},n.param=A,n.parseQuery=r,n.randomColor=function(){return"rgba("+P(0,255,!0)+","+P(0,255,!0)+","+P(0,255,!0)+",1)"},n.repeatString=G,n.roundFixed=function(n,t,r){n=w(n);var e,a=Math.pow(10,t),n=f(Math.round(n*a)/a);return 0<t&&(e=(a=C(n,"."))[0],(a=a[1]||"").length<t&&(a=T(a,t,"0"),n=(a=r?a.replace(/0+$/,""):a)?e+"."+a:e)),n},n.shake=function(n,t){return t=Object.assign({string:!0,array:!0,kvPair:!0},t),function a(n,t){if(s(n))for(var r in n){var e=n[r];(d(e)||s(e))&&a(e,t),U(e,t)&&delete n[r]}}(n=S(n),t),n},n.sortWithIndex=function(n,t){for(var r=[],e=0;e<n.length;e++)r[e]=n[t[e]];return r},n.spanTable=function(n,a){var u=S(n),c={};function r(a,i){var o=0;u.forEach(function(n,t){n.$rowSpan=null!=(e=n.$rowSpan)?e:{};var r,e=n[a];c[a]=null!=(r=c[a])?r:0,1<c[a]?(n.$rowSpan[a]=0,c[a]--):(r=function(n,t,r,e){var a=1;for(n++;n<e.length;n++){var i=e[n][t];if(i!==r&&!y(i))break;a++}return a}(t,a,e,u),void 0!==i&&(e=function(n,t,r){for(var e=0;0<=t&&!(0<(e=n[t].$rowSpan[r]));t--);return e}(u,t,i),0<o?e<=o+r?(r=e-o,o=0):o+=r:r<e?o=r:r=e),c[a]=r,n.$rowSpan[a]=c[a])})}return a.forEach(function(n,t){r(n,a[t-1])}),u.forEach(function(r){r.$colSpan={};var e=0;a.forEach(function(n,t){n=r[n];1<e?(r.$colSpan[t]=0,e--):(e=function(n,t,r,e){var a=1;for(n++;n<e.length;n++){var i=E(r[e[n]]);if(i!==t&&!y(i))break;a++}return a}(t,n,r,a),r.$colSpan[t]=e)})}),u},n.split=C,n.thousands=function(n,a,i){return a=a||3,i=i||",",(v(n)?n:f(n)).replace(/([^.]*)?(\.)?(.*)?/,function(n,t,r,e){return f(t).replace(new RegExp("(.(?=(.{"+a+"})+$))","g"),"$1"+i)+f(r)+f(e)})},n.tree=function(n,t){for(var r=(t=g(t)).id||"id",e=t.pid||"pid",a=t.children||"children",i=0;i<n.length;i++){var o,u=n[i];(o=x(n,function(n){return null!=n[r]&&n[r]!=u[r]&&n[r]===u[e]},a))&&(o[a]=b(o[a]),o[a].push(u),n.splice(i--,1))}return n},n.trim=E,n.union=function(){for(var n=arguments.length,t=new Array(n),r=0;r<n;r++)t[r]=arguments[r];var e=new Set(t);return Array.from(e)},n.urlToGet=function(n,t){n=f(n);var i=s(t)?t:r(t),t=r(n=n.replace(/({{)(.*?)(}})/g,function(n,t,r,e){r=E(r);var a=i[r];return delete i[r],a})),t=A(i=Object.assign(t,i));return n=t?(n=n.replace(/\?.*/,""))+"?"+t:n},n.uuid=function(n){n=w(n);for(var t="",r=0;r<13;r++)t+=P(1,9);return n=(new Date).getTime()*P(1,100),T(F()+Number(t).toString(32)+n.toString(32),20,F()+F()+F())},n.variableHasValue=k});
