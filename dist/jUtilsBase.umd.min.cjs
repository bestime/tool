/**
 * 纯JS工具库 => jUtilsBase 
 * 可在浏览器、nodejs、小程序中使用
 * @QQ 1174295440
 * @see https://github.com/bestime/tool 分支：base
 * @update 2024-03-19 18:22:13
 */
!function(n,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((n="undefined"!=typeof globalThis?globalThis:n||self).jUtilsBase={})}(this,function(n){"use strict";var t=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"],a="Array",u="Object",f="String",P="Number",d=void 0,q="false",A="true",D=Object.prototype.toString,e=encodeURI,i=decodeURIComponent;function c(n){return null===n||n===d}function l(n){return c(n)?"":String(n)}function s(n){return D.call(n).slice(8,-1)}function h(n){return s(n)===a}function v(n){return s(n)===u}function o(n){return s(n)===f}function p(n,t){var r;try{r=JSON.parse(n)}catch(e){r=t}return r}function m(n){return n=v(n)||v(n=p(n))?n:{}}function g(n){return c(n)||""===n}function b(n){return"function"==typeof n}function r(n){var r=[];function i(n,t){null!=n&&""!==n&&(t=null==(t=b(t)?t():t)?"":t,r[r.length]=e(n)+"="+e(t))}return function o(n,t){var r,e;if(n)switch(s(t)){case a:for(r=0;r<t.length;r++)o(n+"["+("object"==typeof t[r]&&t[r]?r:"")+"]",t[r]);break;case u:for(e in t)o(n+"["+e+"]",t[e]);break;default:i(n,t)}else switch(s(t)){case f:case u:for(e in t)o(e,t[e]);break;case a:for(r=0;r<t.length;r++)i(t[r].name,t[r].value)}}("",n),r.join("&")}function y(n){return n=h(n)||h(n=p(n))?n:[]}function _(n){return(n=Number(n))===Math.abs(Infinity)||isNaN(n)?0:n}var B=[d,d];function w(n){if(n==d)return B;var e,i=n;return n.replace(/^\[(.*?)\](.*)?/,function(n,t,r){return i=t,e=r,""}),[i,e]}function S(n){return""===n||/^\d+$/.test(n)}function E(n){var a={},u=!1,e="";return(n=c(n)?"":n).replace(/([^=&?/#]*?)=([^=&?/#]*)/g,function(n,t,o){var r;r=i(o),o=null==r?d:q!==r&&(A===r||p(r,r)),e=i(t),u=!1,""!==e&&(e.replace(/(.*?)(\[.*)/,function(n,t,r){var e=w(r);u=!0,S(e[0])?a[t]=y(a[t]):a[t]=m(a[t]),function i(n,t,r){var t=w(t),e=t[0];S(e)?(e=_(e),t[1]==d?n.push(r):(/^\[[\D]+\]/.test(t[1])?n[e]=m(n[e]):n[e]=y(n[e]),i(n[e],t[1],r))):t[1]==d?n[e]=r:(/^\[[\D]+\]/.test(t[1])?n[e]=m(n[e]):n[e]=y(n[e]),i(n[e],t[1],r))}(a[t],r,o)}),u||(a[e]=o))}),a}var k="[\\s\\uFEFF\\xA0]+";function N(n,t){var r=s(n),e=(r===P&&(n=String(n),r=f),"");if(r!==f)return"";switch(t){case 1:e="^"+k;break;case-1:e=k+"$";break;case"*":e=k;break;default:e="^"+k+"|"+k+"$"}return n.replace(new RegExp(e,"g"),"")}function T(n){switch(s(n)){case a:for(var t=[],r=0;r<n.length;r++)t.push(T(n[r]));break;case u:for(var e in t={},n)t[e]=T(n[e]);break;case"Function":function i(){n.apply(this,arguments)}for(var o in n.prototype)i.prototype[o]=n.prototype[o];t=i;break;default:t=n}return t}function L(n,t){var r=!1;return r=h(n)&&t.array&&0===n.length||v(n)&&t.kvPair&&function(n){var t,r=!0;for(t in n)if(t!==d){r=!1;break}return r}(n)||o(n)&&t.string&&""===n||c(n)?!0:r}function F(n,t,r){var e;r=null==r?60:r,n()?t():(clearTimeout(e),setTimeout(function(){F(n,t,r)},r))}F["async"]=function(t,r){return new Promise(function(n){F(t,n,r)})};var U={id:"id",children:"children"};function x(n){var t=!1;return"boolean"==typeof n||h(n)||null==n||""===n||(n=Number(n),t=!isNaN(n)&&Infinity!=Math.abs(n)),t}function V(n,t){return c(n)?t:n}function H(n,t){var r="";if((n=l(n)).length*t<1<<28)for(;1==(1&t)&&(r+=n),0!=(t>>>=1);)n+=n;return r}function K(n,t,r,e){return(n=l(n)).length>(t>>=0)?n:(t-=n.length,r.length<t&&(r+=H(r,t/r.length)),-1===e?r.slice(0,t)+n:n+r.slice(0,t))}function M(n,t,r){return K(n,t,r,1)}function O(n,t){return""!==n?n.split(t):[]}function G(n,r,t){var e,i,o=c(t)?"children":t;return function a(n){if(n)for(var t=0;t<n.length;t++){if(i=r(n[t])){e=n[t];break}if(a(n[t][o]),i)break}}(n),e}function R(n,t,r){r=!1===r?0:1;return n=Math.random()*(t-n+r)+n,r?Math.floor(n):n}function $(){return t[R(0,t.length-1)][0]}var j={};function J(n,t){}function Q(n,t,r,e){if(n="【"+n+"】",r&&g(t))throw"字段"+n+"不能为空";if(s(t)!==e)switch(e){case"String":t=String(t);break;case"Number":if(!x(t))throw"字段"+n+"必须为数字";t=Number(t)}return t}var Z={number:function(n,t){return Q(n,t,!(2<arguments.length&&arguments[2]!==undefined)||arguments[2],"Number")},string:function(n,t){return Q(n,t,2<arguments.length&&arguments[2]!==undefined&&arguments[2],"String")}};function I(n){return Array.from(new Set(n))}var z=function(n,t){return Number(n)-Number(t)},W=0,C={};function X(n,t){var r=[],e=[];return n.forEach(function(n){n=t[n],C[n]||(C[n]={id:++W,label:n});n=C[n];r.push(n.id),e.push(n.label)}),{id:r.join("_"),label:e.join("→")}}function Y(n,t){return n===d||t===d?d:(t-n)/n}n.Polling=function(){function n(n){this._timer=void 0,this._timer_info=void 0,this._stamp=0,this._passStamp=0,this._option=void 0,this._option=Object.assign({timeout:6e3,interval:1e3,handler:J},n),this._next=this._next.bind(this),this._doOnce=this._doOnce.bind(this),this.done=this.done.bind(this)}var t=n.prototype;return t._next=function(){return clearInterval(this._timer),this._passStamp=+new Date-this._stamp,this._timer=setTimeout(this._doOnce,this._option.interval),this},t._doOnce=function(){if(this._passStamp>=this._option.timeout)return this._option.onMessage&&this._option.onMessage(0),this.done(),this;this._option.handler(this._next,this.done)},t.start=function(){var n,t=this;this._stamp=+new Date,this.done(),this._doOnce();return this._option.onMessage&&(clearInterval(this._timer_info),this._timer_info=setInterval(function(){n=+new Date-t._stamp,0===(n=Math.max(t._option.timeout-n,0))&&t.done(),t._option.onMessage(n)},100)),this},t.done=function(){return clearTimeout(this._timer),clearTimeout(this._timer_info),this},t.dispose=function(){return this.done(),this},n}(),n._Array=y,n._Boolean=function(n){return!0===n||"true"===n||"1"===n||1===n},n._KvPair=m,n._Number=_,n._String=l,n.arrayRowToColumn=function(n,i){var t,r=[],o=(n.forEach(function(n){n=String(n[i.colField]);r.includes(n)||r.push(n)}),r.sort(null!=(e=i.colSort)?e:z),{}),s=(n.forEach(function(t){var n=X(i.uniqueRowId,t),r={},e=(i.uniqueRowId.forEach(function(n){r[n]=t[n]}),o[n.id]=o[n.id]||{value:r,name:n.label,data:{}},i.colCreate(t[i.colField]).field);o[n.id].data[e]=o[n.id].data[e]||[],o[n.id].data[e].push(t)}),[]);for(t in o)s.push({name:o[t].name,value:o[t].value,data:o[t].data,summary:{}});var a,u,e=r.map(function(n){var t=i.colCreate(n);return{value:n,label:t.label,field:t.field}}),h={};return i.summaryConfig&&(a=s,u=i.summaryConfig,a.forEach(function(f){var n,c=null==u||null==(n=u.row)?void 0:n[f.name];if(c){var l,t,s=0,h=0;for(t in f.data)!function(n){h++;var t,r=[],e=0,i=[],o=[],a=(f.data[n].forEach(function(n){r.push(n[c.count.field]);var t=_(n[c.value.field]);switch(c.value.mode){case"uniqLength":i.push(n[c.value.field]),i=I(i),e+=i.length;break;case"sum":e+=t}0!==t&&o.push(t)}),0);switch(c.count.mode){case"length":a=r.length;break;case"uniqLength":a=I(r).length;break;case"notZeroValue":a=o.length}var u=e/a;s+=u,f.summary[n]={value:u,proportion:0,riseRatio:l?Y(null==(t=f.summary[l])?void 0:t.value,u):void 0},l=n}(t);f.summary[u.averageField]={value:s/h,riseRatio:d,proportion:0}}}),a.forEach(function(n){var t,r=null==u||null==(t=u.row)?void 0:t[n.name];if(r&&r.proportionBaseField){var e=a.find(function(n){return n.name===r.proportionBaseField});if(e)for(var i in n.summary)n.summary[i].proportion=n.summary[i].value/e.summary[i].value}}),h=function(u,e,i){var n,f={},c={},t=function(o){c[o]={},f[o]={};var n,a=e[o],t=(u.forEach(function(r){for(var n in r.data)!function(n){f[o][n]=f[o][n]||{data:[]};var t=[];r.data[n].forEach(function(n){t.push(n[a.field]),"uniqLength"===a.mode&&(t=I(t))}),f[o][n].data=f[o][n].data.concat(t)}(n)}),u.forEach(function(n){var t,r,e,i;for(e in n.data)c[o][e]=f[o][e]||0,"uniqLength"===a.mode&&(i=f[o][e].data.length/u.length,c[o][e]={value:i,proportion:0,riseRatio:r?Y(null==(t=c[o][r])?void 0:t.value,i):void 0}),r=e}),0),r=0;for(n in c[o])t+=c[o][n].value,r++;c[o][i]={value:t/r,riseRatio:d,proportion:0}};for(n in e)t(n);return c}(s=a,i.summaryConfig.column,i.summaryConfig.averageField)),{columns:e,data:s,colSummary:h,getExtRow:function(t,n,r){var e,i=s.find(function(n){return n.name===t}),o={};if(!i){var a=n,u=r,f=h[t],c={};if(f)for(var l in f)c[l]=u(f[l][a]);return c}for(e in i.summary)o[e]=r(i.summary[e][n]);return o}}},n.changeIndex=function(n,t,r){return n<0?t:((t=(t+r)%(n+=1))<0&&(t+=n),-0===t?0:t)},n.cloneEasy=T,n.dataPage=function(n,t,r){if(r<1)throw"页码必须大于0";var e=(r-1)*t,i=e+t;return{current:r,total:n.length,size:t,pages:Math.ceil(n.length/t),data:T(n.slice(e,i))}},n.deepFindItem=G,n.deepFindTreePath=function(n,t,r){r=Object.assign(U,r);for(var e=[],i=T(n),o=new Set,a=r["children"];i.length;){var u=i[0];if(o.has(u))e.pop(),i.shift();else if(o.add(u),u[a]&&i.unshift.apply(i,u[a]),e.push(u),t(u))return e}return undefined},n.defaultValue=V,n.defineEventBus=function(i){if(j[i])throw'"'+i+'" Has already been registered!';return j[i]=j[i]||[],{on:function(n){j[i].push(n)},emit:function(){for(var n=arguments.length,t=new Array(n),r=0;r<n;r++)t[r]=arguments[r];for(var e=0;e<j[i].length;e++)j[i][e].apply(d,t)},off:function(n){if(!n)throw"the hander of off is required!";for(var t=0;t<j[i].length;t++)j[i][t]===n&&j[i].splice(t--,1)},dispose:function(){for(var n=0;n<j[i].length;n++)j[i].splice(n--,1);delete j[i]}}},n.fieldCheck=Z,n.flatTree=function(n,e){var i=[];return e=V(e,"children"),function o(n){if(h(n))for(var t,r=0;r<n.length;r++)t=n[r],i.push(t),o(t[e])}(n),i},n.floorFixed=function(n,t,r){var e=(n=O(n=N(_(n)),"."))[1]||"";return e.length<t&&(e=M(e,t,"0"),r&&(e=e.replace(/0+$/,""))),t<1||!e?n[0]:n[0]+"."+e.substring(0,t)},n.forEach=function(n,t){for(var r=0;r<n.length;r++)t(n[r],r,n)},n.forEachTree=function(n,r,e){e=e||"children",function i(n){for(var t=0;t<n.length;t++)r(n[t]),h(n[t][e])&&i(n[t][e])}(n)},n.getRandom=R,n.getType=s,n.isArray=h,n.isEmpty=g,n.isFunction=b,n.isKvPair=v,n.isLikeNumber=x,n.isNull=c,n.isString=o,n.mapTree=function(n,e,i,o){o=o||"children";var t=[];return function a(n,t){for(var r=0;r<n.length;r++)t[r]=T(i(n[r])),n[r][o]&&(t[r][e]=[],a(n[r][o],t[r][e]))}(n,t),t},n.padEnd=M,n.padStart=function(n,t,r){return K(n,t,r,-1)},n.param=r,n.parseQuery=E,n.randomColor=function(){return"rgba("+R(0,255,!0)+","+R(0,255,!0)+","+R(0,255,!0)+",1)"},n.repeatString=H,n.roundFixed=function(n,t,r){n=_(n);var e,i=Math.pow(10,t),n=l(Math.round(n*i)/i);return 0<t&&(e=(i=O(n,"."))[0],(i=i[1]||"").length<t&&(i=M(i,t,"0"),n=(i=r?i.replace(/0+$/,""):i)?e+"."+i:e)),n},n.shake=function(n,t){return t=Object.assign({string:!0,array:!0,kvPair:!0},t),function i(n,t){if(v(n))for(var r in n){var e=n[r];(h(e)||v(e))&&i(e,t),L(e,t)&&delete n[r]}}(n=T(n),t),n},n.spanTable=function(n,i){var u=T(n),f={};function r(i,o){var a=0;u.forEach(function(n,t){n.$rowSpan=null!=(e=n.$rowSpan)?e:{};var r,e=n[i];f[i]=null!=(r=f[i])?r:0,1<f[i]?(n.$rowSpan[i]=0,f[i]--):(r=function(n,t,r,e){var i=1;for(n++;n<e.length&&e[n][t]===r;n++)i++;return i}(t,i,e,u),void 0!==o&&(e=function(n,t,r){for(var e=0;0<=t&&!(0<(e=n[t].$rowSpan[r]));t--);return e}(u,t,o),0<a?e<=a+r?(r=e-a,a=0):a+=r:r<e?a=r:r=e),f[i]=r,n.$rowSpan[i]=f[i])})}return i.forEach(function(n,t){r(n,i[t-1])}),u.forEach(function(r){r.$colSpan={};var e=0;i.forEach(function(n,t){n=r[n];1<e?(r.$colSpan[t]=0,e--):(e=function(n,t,r,e){var i=1;for(n++;n<e.length;n++){var o=N(r[e[n]],"*");if(o!==t&&!g(o))break;i++}return i}(t,n,r,i),r.$colSpan[t]=e)})}),u},n.split=O,n.tree=function(n,t){for(var r=(t=m(t)).id||"id",e=t.pid||"pid",i=t.children||"children",o=0;o<n.length;o++){var a,u=n[o];(a=G(n,function(n){return null!=n[r]&&n[r]!=u[r]&&n[r]===u[e]},i))&&(a[i]=y(a[i]),a[i].push(u),n.splice(o--,1))}return n},n.trim=N,n.urlToGet=function(n,t){n=l(n);var o=v(t)?t:E(t),t=E(n=n.replace(/({{)(.*?)(}})/g,function(n,t,r,e){r=N(r);var i=o[r];return delete o[r],i})),t=r(o=Object.assign(t,o));return n=t?(n=n.replace(/\?.*/,""))+"?"+t:n},n.uuid=function(n){n=_(n);for(var t="",r=0;r<13;r++)t+=R(1,9);return n=(new Date).getTime()*R(1,100),M($()+Number(t).toString(32)+n.toString(32),20,$()+$()+$())},n.variableHasValue=F});
