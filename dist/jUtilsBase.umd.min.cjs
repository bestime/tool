/**  
 * 个人工具库 => jUtilsBase 
 * @QQ 1174295440
 * @author Bestime
 * @see https://github.com/bestime/tool
 * @update 2023-10-21 15:38:49
 */
!function(n,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((n="undefined"!=typeof globalThis?globalThis:n||self).jUtilsBase={})}(this,function(n){"use strict";function a(n){return null===n||n===undefined}function o(n){return a(n)?"":String(n)}var u="Array",f="Object",s="String",B="Number",c=void 0,D="false",R="true",U=Object.prototype.toString,r=encodeURI,i=decodeURIComponent,t="undefined"!=typeof document&&document.getElementById!==undefined,C="undefined"!=typeof window?window:c;function l(n){return U.call(n).slice(8,-1)}function h(n){return l(n)===u}function d(n){return l(n)===f}function p(n,t){var e;try{e=JSON.parse(n)}catch(r){e=t}return e}function v(n){return n=d(n)||d(n=p(n))?n:{}}function g(n){return"function"==typeof n}function m(n){var e=[];function i(n,t){null!=n&&""!==n&&(t=null==(t=g(t)?t():t)?"":t,e[e.length]=r(n)+"="+r(t))}return function o(n,t){var e,r;if(n)switch(l(t)){case u:for(e=0;e<t.length;e++)o(n+"["+("object"==typeof t[e]&&t[e]?e:"")+"]",t[e]);break;case f:for(r in t)o(n+"["+r+"]",t[r]);break;default:i(n,t)}else switch(l(t)){case s:case f:for(r in t)o(r,t[r]);break;case u:for(e=0;e<t.length;e++)i(t[e].name,t[e].value)}}("",n),e.join("&")}t?document.getElementsByTagName("head")[0]:undefined;var _="[\\s\\uFEFF\\xA0]+";function b(n,t){var e=l(n),r=(e===B&&(n=String(n),e=s),"");if(e!==s)return"";switch(t){case 1:r="^"+_;break;case-1:r=_+"$";break;case"*":r=_;break;default:r="^"+_+"|"+_+"$"}return n.replace(new RegExp(r,"g"),"")}function y(n){return l(n)===s}function w(n){var t,e=!0;for(t in n)if(t!==undefined){e=!1;break}return e}function k(n,t,e,r){y(n)?t&&""==b(n,"*")||r(n):null!=n&&(e&&d(n)&&w(n),r(n))}function T(n){switch(l(n)){case u:for(var t=[],e=0;e<n.length;e++)t.push(T(n[e]));break;case f:for(var r in t={},n)t[r]=T(n[r]);break;case"Function":function i(){n.apply(this,arguments)}for(var o in n.prototype)i.prototype[o]=n.prototype[o];t=i;break;default:t=n}return t}function x(n,t){if(d(n))for(var e in n){var r=n[e];(h(r)||d(r))&&x(r,t),i=t,o=!1,(o=!!(h(r=r)&&i.array&&0===r.length||d(r)&&i.kvPair&&w(r)||y(r)&&i.string&&""===r||a(r))||o)&&delete n[e]}var i,o}function S(n){return n=h(n)||h(n=p(n))?n:[]}function O(n,t,e){var r;e=null==e?60:e,n()?t():(clearTimeout(r),setTimeout(function(){O(n,t,e)},e))}O["async"]=function(t,e){return new Promise(function(n){O(t,n,e)})};var H={id:"id",children:"children"};function M(n){return(n=Number(n))===Math.abs(Infinity)||isNaN(n)?0:n}function e(n,t){return a(n)?t:n}function j(n,t){var e="";if((n=o(n)).length*t<1<<28)for(;1==(1&t)&&(e+=n),0!=(t>>>=1);)n+=n;return e}function E(n,t,e,r){return(n=o(n)).length>(t>>=0)?n:(t-=n.length,e.length<t&&(e+=j(e,t/e.length)),-1===r?e.slice(0,t)+n:n+e.slice(0,t))}function F(n,t,e){return E(n,t,e,1)}function I(n,t){return""!==n?n.split(t):[]}function N(n,e,t){var r,i,o=a(t)?"children":t;return function u(n){if(n)for(var t=0;t<n.length;t++){if(i=e(n[t])){r=n[t];break}if(u(n[t][o]),i)break}}(n),r}function P(n,t,e){e=!1===e?0:1;return n=Math.random()*(t-n+e)+n,e?Math.floor(n):n}var $={};function K(n,t){}var V=[c,c];function q(n){if(n==c)return V;var r,i=n;return n.replace(/^\[(.*?)\](.*)?/,function(n,t,e){return i=t,r=e,""}),[i,r]}function G(n){return""===n||/^\d+$/.test(n)}n.Polling=function(){function n(n){this._timer=void 0,this._timer_info=void 0,this._stamp=0,this._passStamp=0,this._option=void 0,this._option=Object.assign({timeout:6e3,interval:1e3,handler:K},n),this._next=this._next.bind(this),this._doOnce=this._doOnce.bind(this),this.done=this.done.bind(this)}var t=n.prototype;return t._next=function(){return clearInterval(this._timer),this._passStamp=+new Date-this._stamp,this._timer=setTimeout(this._doOnce,this._option.interval),this},t._doOnce=function(){if(this._passStamp>=this._option.timeout)return this._option.onMessage&&this._option.onMessage(0),this.done(),this;this._option.handler(this._next,this.done)},t.start=function(){var n,t=this;this._stamp=+new Date,this.done(),this._doOnce();return this._option.onMessage&&(clearInterval(this._timer_info),this._timer_info=setInterval(function(){n=+new Date-t._stamp,0===(n=Math.max(t._option.timeout-n,0))&&t.done(),t._option.onMessage(n)},100)),this},t.done=function(){return clearTimeout(this._timer),clearTimeout(this._timer_info),this},t.dispose=function(){return this.done(),this},n}(),n._Array=S,n._Boolean=function(n){return!0===n||"true"===n||"1"===n||1===n},n._KvPair=v,n._Number=M,n._String=o,n.changeIndex=function(n,t,e){return n<0?t:((t=(t+e)%(n+=1))<0&&(t+=n),-0===t?0:t)},n.clean=function A(n,t,e){if(e=!1!==e,d(n)){var r,i,o={};for(i in n)k(h(r=n[i])||d(r)?A(r,t):r,t,e,function(n){o[i]=n})}else if(h(n)){o=[];for(var u=0,a=n.length;u<a;u++)k(A(n[u],t),t,e,function(n){o.push(n)})}else o=n;return o},n.cloneEasy=T,n.deepFindItem=N,n.deepFindTreePath=function(n,t,e){e=Object.assign(H,e);for(var r=[],i=T(n),o=new Set,u=e["children"];i.length;){var a=i[0];if(o.has(a))r.pop(),i.shift();else if(o.add(a),a[u]&&i.unshift.apply(i,a[u]),r.push(a),t(a))return r}return undefined},n.defaultValue=e,n.defineEventBus=function(i){if($[i])throw'"'+i+'" Has already been registered!';return $[i]=$[i]||[],{on:function(n){$[i].push(n)},emit:function(){for(var n=arguments.length,t=new Array(n),e=0;e<n;e++)t[e]=arguments[e];for(var r=0;r<$[i].length;r++)$[i][r].apply(c,t)},off:function(n){if(!n)throw"the hander of off is required!";for(var t=0;t<$[i].length;t++)$[i][t]===n&&$[i].splice(t--,1)},dispose:function(){for(var n=0;n<$[i].length;n++)$[i].splice(n--,1);delete $[i]}}},n.flatTree=function(n,r){var i=[];return r=e(r,"children"),function o(n){if(h(n))for(var t,e=0;e<n.length;e++)t=n[e],i.push(t),o(t[r])}(n),i},n.floorFixed=function(n,t,e){var r=(n=I(n=b(M(n)),"."))[1]||"";return r.length<t&&(r=F(r,t,"0"),e&&(r=r.replace(/0+$/,""))),t<1||!r?n[0]:n[0]+"."+r.substring(0,t)},n.forEachTree=function(n,e,r){r=r||"children",function i(n){for(var t=0;t<n.length;t++)e(n[t]),h(n[t][r])&&i(n[t][r])}(n)},n.getRandom=P,n.getType=l,n.isArray=h,n.isEmpty=function(n){return a(n)||""===n},n.isFunction=g,n.isKvPair=d,n.isNull=a,n.mapTree=function(n,r,i,o){o=o||"children";var t=[];return function u(n,t){for(var e=0;e<n.length;e++)t[e]=T(i(n[e])),n[e][o]&&(t[e][r]=[],u(n[e][o],t[e][r]))}(n,t),t},n.padEnd=F,n.padStart=function(n,t,e){return E(n,t,e,-1)},n.param=m,n.parseQuery=function(n){var u,r,a={};return(n=n||t&&C.location.href||"").replace(/([^=&?/#]*?)=([^=&?/#]*)/g,function(n,t,o){var e;e=i(o),o=null==e?undefined:D!==e&&(R===e||p(e,e)),r=i(t),u=!1,""!==r&&(r.replace(/(.*?)(\[.*)/,function(n,t,e){var r=q(e);u=!0,G(r[0])?a[t]=S(a[t]):a[t]=v(a[t]),function i(n,t,e){var t=q(t),r=t[0];G(r)?(r=M(r),t[1]==c?n.push(e):(/^\[[\D]+\]/.test(t[1])?n[r]=v(n[r]):n[r]=S(n[r]),i(n[r],t[1],e))):t[1]==c?n[r]=e:(/^\[[\D]+\]/.test(t[1])?n[r]=v(n[r]):n[r]=S(n[r]),i(n[r],t[1],e))}(a[t],e,o)}),u||(a[r]=o))}),a},n.randomColor=function(){return"rgba("+P(0,255,!0)+","+P(0,255,!0)+","+P(0,255,!0)+",1)"},n.repeatString=j,n.roundFixed=function(n,t,e){n=M(n);var r,i=Math.pow(10,t),n=o(Math.round(n*i)/i);return 0<t&&(r=(i=I(n,"."))[0],(i=i[1]||"").length<t&&(i=F(i,t,"0"),n=(i=e?i.replace(/0+$/,""):i)?r+"."+i:r)),n},n.shake=function(n,t){return t=Object.assign({string:!0,array:!0,kvPair:!0},t),x(n=T(n),t),n},n.split=I,n.tree=function(n,t){for(var e=(t=v(t)).id||"id",r=t.pid||"pid",i=t.children||"children",o=0;o<n.length;o++){var u,a=n[o];(u=N(n,function(n){return null!=n[e]&&n[e]!=a[e]&&n[e]===a[r]},i))&&(u[i]=S(u[i]),u[i].push(a),n.splice(o--,1))}return n},n.trim=b,n.urlToGet=function(n,t){n=o(n).replace(/&*$/g,"").replace(/\?*$/,"");var e="";return(e=d(t)||h(t)?m(t):o(t).replace(/^&*/,""))&&(n+=(/\?/.test(n)?"&":"?")+e),n},n.variableHasValue=O});
