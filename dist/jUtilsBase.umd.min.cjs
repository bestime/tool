/**
 * 纯JS工具库 => jUtilsBase 
 * 可在浏览器、nodejs、小程序中使用
 * @QQ 1174295440
 * @see https://github.com/bestime/tool 分支：base
 * @update 2024-03-21 15:50:23
 */
!function(n,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((n="undefined"!=typeof globalThis?globalThis:n||self).jUtilsBase={})}(this,function(n){"use strict";var t=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"],o="Array",u="Object",f="String",P="Number",v=void 0,q="false",A="true",D=Object.prototype.toString,r=encodeURI,i=decodeURIComponent;function c(n){return null===n||n===v}function s(n){return c(n)?"":String(n)}function l(n){return D.call(n).slice(8,-1)}function h(n){return l(n)===o}function d(n){return l(n)===u}function a(n){return l(n)===f}function p(n,t){var e;try{e=JSON.parse(n)}catch(r){e=t}return e}function m(n){return n=d(n)||d(n=p(n))?n:{}}function g(n){return c(n)||""===n}function b(n){return"function"==typeof n}function e(n){var e=[];function i(n,t){null!=n&&""!==n&&(t=null==(t=b(t)?t():t)?"":t,e[e.length]=r(n)+"="+r(t))}return function a(n,t){var e,r;if(n)switch(l(t)){case o:for(e=0;e<t.length;e++)a(n+"["+("object"==typeof t[e]&&t[e]?e:"")+"]",t[e]);break;case u:for(r in t)a(n+"["+r+"]",t[r]);break;default:i(n,t)}else switch(l(t)){case f:case u:for(r in t)a(r,t[r]);break;case o:for(e=0;e<t.length;e++)i(t[e].name,t[e].value)}}("",n),e.join("&")}function y(n){return n=h(n)||h(n=p(n))?n:[]}function _(n){return(n=Number(n))===Math.abs(Infinity)||isNaN(n)?0:n}var L=[v,v];function w(n){if(n==v)return L;var r,i=n;return n.replace(/^\[(.*?)\](.*)?/,function(n,t,e){return i=t,r=e,""}),[i,r]}function S(n){return""===n||/^\d+$/.test(n)}function k(n){var o={},u=!1,r="";return(n=c(n)?"":n).replace(/([^=&?/#]*?)=([^=&?/#]*)/g,function(n,t,a){var e;e=i(a),a=null==e?v:q!==e&&(A===e||p(e,e)),r=i(t),u=!1,""!==r&&(r.replace(/(.*?)(\[.*)/,function(n,t,e){var r=w(e);u=!0,S(r[0])?o[t]=y(o[t]):o[t]=m(o[t]),function i(n,t,e){var t=w(t),r=t[0];S(r)?(r=_(r),t[1]==v?n.push(e):(/^\[[\D]+\]/.test(t[1])?n[r]=m(n[r]):n[r]=y(n[r]),i(n[r],t[1],e))):t[1]==v?n[r]=e:(/^\[[\D]+\]/.test(t[1])?n[r]=m(n[r]):n[r]=y(n[r]),i(n[r],t[1],e))}(o[t],e,a)}),u||(o[r]=a))}),o}var E="[\\s\\uFEFF\\xA0]+";function N(n,t){var e=l(n),r=(e===P&&(n=String(n),e=f),"");if(e!==f)return"";switch(t){case 1:r="^"+E;break;case-1:r=E+"$";break;case"*":r=E;break;default:r="^"+E+"|"+E+"$"}return n.replace(new RegExp(r,"g"),"")}function T(n){switch(l(n)){case o:for(var t=[],e=0;e<n.length;e++)t.push(T(n[e]));break;case u:for(var r in t={},n)t[r]=T(n[r]);break;case"Function":function i(){n.apply(this,arguments)}for(var a in n.prototype)i.prototype[a]=n.prototype[a];t=i;break;default:t=n}return t}function B(n,t){var e=!1;return e=h(n)&&t.array&&0===n.length||d(n)&&t.kvPair&&function(n){var t,e=!0;for(t in n)if(t!==v){e=!1;break}return e}(n)||a(n)&&t.string&&""===n||c(n)?!0:e}function F(n,t,e){var r;e=null==e?60:e,n()?t():(clearTimeout(r),setTimeout(function(){F(n,t,e)},e))}F["async"]=function(t,e){return new Promise(function(n){F(t,n,e)})};var U={id:"id",children:"children"};function x(n){var t=!1;return"boolean"==typeof n||h(n)||null==n||""===n||(n=Number(n),t=!isNaN(n)&&Infinity!=Math.abs(n)),t}function V(n,t){return c(n)?t:n}function H(n,t){var e="";if((n=s(n)).length*t<1<<28)for(;1==(1&t)&&(e+=n),0!=(t>>>=1);)n+=n;return e}function K(n,t,e,r){return(n=s(n)).length>(t>>=0)?n:(t-=n.length,e.length<t&&(e+=H(e,t/e.length)),-1===r?e.slice(0,t)+n:n+e.slice(0,t))}function C(n,t,e){return K(n,t,e,1)}function M(n,t){return""!==n?n.split(t):[]}function G(n,e,t){var r,i,a=c(t)?"children":t;return function o(n){if(n)for(var t=0;t<n.length;t++){if(i=e(n[t])){r=n[t];break}if(o(n[t][a]),i)break}}(n),r}function O(n,t,e){e=!1===e?0:1;return n=Math.random()*(t-n+e)+n,e?Math.floor(n):n}function R(){return t[O(0,t.length-1)][0]}var $={};function J(n,t){}function Q(n,t,e,r){if(n="【"+n+"】",e&&g(t))throw"字段"+n+"不能为空";if(l(t)!==r)switch(r){case"String":t=String(t);break;case"Number":if(!x(t))throw"字段"+n+"必须为数字";t=Number(t)}return t}var Z={number:function(n,t){return Q(n,t,!(2<arguments.length&&arguments[2]!==undefined)||arguments[2],"Number")},string:function(n,t){return Q(n,t,2<arguments.length&&arguments[2]!==undefined&&arguments[2],"String")}};function j(n){return Array.from(new Set(n))}var z=function(n,t){return Number(n)-Number(t)},W=0,I={};function X(n,t){var e=[],r=[];return n.forEach(function(n){n=t[n],I[n]||(I[n]={id:++W,label:n});n=I[n];e.push(n.id),r.push(n.label)}),{id:e.join("_"),label:r.join("→")}}function Y(n,t){return n===v||t===v?v:(t-n)/n}n.Polling=function(){function n(n){this._timer=void 0,this._timer_info=void 0,this._stamp=0,this._passStamp=0,this._option=void 0,this._option=Object.assign({timeout:6e3,interval:1e3,handler:J},n),this._next=this._next.bind(this),this._doOnce=this._doOnce.bind(this),this.done=this.done.bind(this)}var t=n.prototype;return t._next=function(){return clearInterval(this._timer),this._passStamp=+new Date-this._stamp,this._timer=setTimeout(this._doOnce,this._option.interval),this},t._doOnce=function(){if(this._passStamp>=this._option.timeout)return this._option.onMessage&&this._option.onMessage(0),this.done(),this;this._option.handler(this._next,this.done)},t.start=function(){var n,t=this;this._stamp=+new Date,this.done(),this._doOnce();return this._option.onMessage&&(clearInterval(this._timer_info),this._timer_info=setInterval(function(){n=+new Date-t._stamp,0===(n=Math.max(t._option.timeout-n,0))&&t.done(),t._option.onMessage(n)},100)),this},t.done=function(){return clearTimeout(this._timer),clearTimeout(this._timer_info),this},t.dispose=function(){return this.done(),this},n}(),n._Array=y,n._Boolean=function(n){return!0===n||"true"===n||"1"===n||1===n},n._KvPair=m,n._Number=_,n._String=s,n.arrayRowToColumn=function(n,i){var t,e=[],a=(n.forEach(function(n){n=String(n[i.colField]);e.includes(n)||e.push(n)}),e.sort(null!=(f=i.colSort)?f:z),{}),l=(n.forEach(function(t){var n=X(i.uniqueRowId,t),e={},r=(i.uniqueRowId.forEach(function(n){e[n]=t[n]}),a[n.id]=a[n.id]||{value:e,name:n.label,data:{}},i.colCreate(t[i.colField]).field);a[n.id].data[r]=a[n.id].data[r]||[],a[n.id].data[r].push(t)}),[]);for(t in a)l.push({name:a[t].name,value:a[t].value,data:a[t].data,summary:{},other:{}});var o,u,r,f=e.map(function(n){var t=i.colCreate(n);return{value:n,label:t.label,field:t.field}}),h={};return i.summaryConfig&&(i.summaryConfig.row&&(o=l,u=i.summaryConfig.row,r=i.summaryConfig.averageField,o.forEach(function(f){var c=u[f.name];if(c){var s,n,l=0,h=0;for(n in f.data)!function(n){h++;var t,e=[],r=0,i=[],a=[],o=(f.data[n].forEach(function(n){e.push(n[c.count.field]);var t=_(n[c.value.field]);switch(c.value.mode){case"uniqLength":i.push(n[c.value.field]),i=j(i),r+=i.length;break;case"sum":case"avg":r+=t}0!==t&&a.push(t)}),0);switch(c.count.mode){case"length":o=e.length;break;case"uniqLength":o=j(e).length;break;case"notZeroValue":o=a.length}var u=r;"avg"===c.value.mode&&(u=r/o),l+=u,f.summary[n]={value:u,proportion:0,riseRatio:s?Y(null==(t=f.summary[s])?void 0:t.value,u):void 0},s=n}(n);f.summary[r]={value:l/h,riseRatio:v,proportion:0}}}),o.forEach(function(n){var t=u[n.name];if(t){var e=o.find(function(n){return n.name===t.proportionBaseField});if(t.proportionBaseField&&e)for(var r in n.summary)n.summary[r].proportion=n.summary[r].value/e.summary[r].value}}),l=o),i.summaryConfig.column&&(h=function(c,s,l){var n,h={},d={},t=function(i){d[i]={},h[i]={};var n,a=s[i],t=(c.forEach(function(r){for(var n in r.data)!function(n){h[i][n]=h[i][n]||{data:[],sum:0};var t=[],e=0;switch(r.data[n].forEach(function(n){switch(t.push(n[a.field]),a.mode){case"uniqLength":t=j(t);break;case"avg":e+=n[a.field]}}),a.mode){case"uniqLength":t=j(t);break;case"avg":e/=r.data[n].length}h[i][n].data=h[i][n].data.concat(t),h[i][n].sum+=e}(n)}),void 0);for(n in h[i]){var e,r=0;switch(a.mode){case"avg":r=h[i][n].sum/c.length;break;case"uniqLength":r=h[i][n].data.length/c.length}d[i][n]={value:r,proportion:0,riseRatio:t?Y(null==(e=d[i][t])?void 0:e.value,r):void 0},t=n}var o,u=0,f=0;for(o in d[i])u+=d[i][o].value,f++;d[i][l]={value:u/f,riseRatio:v,proportion:0}};for(n in s)t(n);return d}(l,i.summaryConfig.column,i.summaryConfig.averageField))),{columns:f,data:l,colSummary:h,getExtRow:function(t,n,e){var r,i=l.find(function(n){return n.name===t}),a={};if(!i){var o=n,u=e,f=h[t],c={};if(f)for(var s in f)c[s]=u(f[s][o]);return c}for(r in i.summary)a[r]=e(i.summary[r][n]);return a}}},n.changeIndex=function(n,t,e){return n<0?t:((t=(t+e)%(n+=1))<0&&(t+=n),-0===t?0:t)},n.cloneEasy=T,n.dataPage=function(n,t,e){if(e<1)throw"页码必须大于0";var r=(e-1)*t,i=r+t;return{current:e,total:n.length,size:t,pages:Math.ceil(n.length/t),data:T(n.slice(r,i))}},n.deepFindItem=G,n.deepFindTreePath=function(n,t,e){e=Object.assign(U,e);for(var r=[],i=T(n),a=new Set,o=e["children"];i.length;){var u=i[0];if(a.has(u))r.pop(),i.shift();else if(a.add(u),u[o]&&i.unshift.apply(i,u[o]),r.push(u),t(u))return r}return undefined},n.defaultValue=V,n.defineEventBus=function(i){if($[i])throw'"'+i+'" Has already been registered!';return $[i]=$[i]||[],{on:function(n){$[i].push(n)},emit:function(){for(var n=arguments.length,t=new Array(n),e=0;e<n;e++)t[e]=arguments[e];for(var r=0;r<$[i].length;r++)$[i][r].apply(v,t)},off:function(n){if(!n)throw"the hander of off is required!";for(var t=0;t<$[i].length;t++)$[i][t]===n&&$[i].splice(t--,1)},dispose:function(){for(var n=0;n<$[i].length;n++)$[i].splice(n--,1);delete $[i]}}},n.fieldCheck=Z,n.flatTree=function(n,r){var i=[];return r=V(r,"children"),function a(n){if(h(n))for(var t,e=0;e<n.length;e++)t=n[e],i.push(t),a(t[r])}(n),i},n.floorFixed=function(n,t,e){var r=(n=M(n=N(_(n)),"."))[1]||"";return r.length<t&&(r=C(r,t,"0"),e&&(r=r.replace(/0+$/,""))),t<1||!r?n[0]:n[0]+"."+r.substring(0,t)},n.forEach=function(n,t){for(var e=0;e<n.length;e++)t(n[e],e,n)},n.forEachTree=function(n,e,r){r=r||"children",function i(n){for(var t=0;t<n.length;t++)e(n[t]),h(n[t][r])&&i(n[t][r])}(n)},n.getRandom=O,n.getType=l,n.isArray=h,n.isEmpty=g,n.isFunction=b,n.isKvPair=d,n.isLikeNumber=x,n.isNull=c,n.isString=a,n.mapTree=function(n,r,i,a){a=a||"children";var t=[];return function o(n,t){for(var e=0;e<n.length;e++)t[e]=T(i(n[e])),n[e][a]&&(t[e][r]=[],o(n[e][a],t[e][r]))}(n,t),t},n.padEnd=C,n.padStart=function(n,t,e){return K(n,t,e,-1)},n.param=e,n.parseQuery=k,n.randomColor=function(){return"rgba("+O(0,255,!0)+","+O(0,255,!0)+","+O(0,255,!0)+",1)"},n.repeatString=H,n.roundFixed=function(n,t,e){n=_(n);var r,i=Math.pow(10,t),n=s(Math.round(n*i)/i);return 0<t&&(r=(i=M(n,"."))[0],(i=i[1]||"").length<t&&(i=C(i,t,"0"),n=(i=e?i.replace(/0+$/,""):i)?r+"."+i:r)),n},n.shake=function(n,t){return t=Object.assign({string:!0,array:!0,kvPair:!0},t),function i(n,t){if(d(n))for(var e in n){var r=n[e];(h(r)||d(r))&&i(r,t),B(r,t)&&delete n[e]}}(n=T(n),t),n},n.spanTable=function(n,i){var u=T(n),f={};function e(i,a){var o=0;u.forEach(function(n,t){n.$rowSpan=null!=(r=n.$rowSpan)?r:{};var e,r=n[i];f[i]=null!=(e=f[i])?e:0,1<f[i]?(n.$rowSpan[i]=0,f[i]--):(e=function(n,t,e,r){var i=1;for(n++;n<r.length;n++){var a=r[n][t];if(a!==e&&!g(a))break;i++}return i}(t,i,r,u),void 0!==a&&(r=function(n,t,e){for(var r=0;0<=t&&!(0<(r=n[t].$rowSpan[e]));t--);return r}(u,t,a),0<o?r<=o+e?(e=r-o,o=0):o+=e:e<r?o=e:e=r),f[i]=e,n.$rowSpan[i]=f[i])})}return i.forEach(function(n,t){e(n,i[t-1])}),u.forEach(function(e){e.$colSpan={};var r=0;i.forEach(function(n,t){n=e[n];1<r?(e.$colSpan[t]=0,r--):(r=function(n,t,e,r){var i=1;for(n++;n<r.length;n++){var a=N(e[r[n]],"*");if(a!==t&&!g(a))break;i++}return i}(t,n,e,i),e.$colSpan[t]=r)})}),u},n.split=M,n.tree=function(n,t){for(var e=(t=m(t)).id||"id",r=t.pid||"pid",i=t.children||"children",a=0;a<n.length;a++){var o,u=n[a];(o=G(n,function(n){return null!=n[e]&&n[e]!=u[e]&&n[e]===u[r]},i))&&(o[i]=y(o[i]),o[i].push(u),n.splice(a--,1))}return n},n.trim=N,n.urlToGet=function(n,t){n=s(n);var a=d(t)?t:k(t),t=k(n=n.replace(/({{)(.*?)(}})/g,function(n,t,e,r){e=N(e);var i=a[e];return delete a[e],i})),t=e(a=Object.assign(t,a));return n=t?(n=n.replace(/\?.*/,""))+"?"+t:n},n.uuid=function(n){n=_(n);for(var t="",e=0;e<13;e++)t+=O(1,9);return n=(new Date).getTime()*O(1,100),C(R()+Number(t).toString(32)+n.toString(32),20,R()+R()+R())},n.variableHasValue=F});
