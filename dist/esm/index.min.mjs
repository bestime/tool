/**  
 * 个人工具库 (TS版)
 * @QQ 1174295440
 * @author Bestime
 * @see https://github.com/bestime/tool
 * @update 2023-05-05 16:49:37
 */
function isNull(e){return null===e||e===undefined}function _String(e){return isNull(e)?"":String(e)}var $letters=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"],$ArrayTypeNameBig="Array",$FunctionTypeNameBig="Function",$ObjectTypeNameBig="Object",$stringTypeNameBig="String",$numberTypeNameBig="Number",$undefinedValue=undefined,$zeroString="0",$falseString="false",$trueString="true",$ObjectTypeNameBigPrototypeToString=Object.prototype.toString,$encodeURIComponent=encodeURIComponent,$decodeURIComponent=decodeURIComponent,$regSpaceStr="\\s\\uFEFF\\xA0",$isBroswer="undefined"!=typeof document&&document.getElementById!==undefined,$browserGlobal=window,$headElement=$isBroswer?document.getElementsByTagName("head")[0]:undefined;function getType(e){return $ObjectTypeNameBigPrototypeToString.call(e).slice(8,-1)}function isArray(e){return getType(e)===$ArrayTypeNameBig}function isKvPair(e){return getType(e)===$ObjectTypeNameBig}function hpJsonParse(e,t){var n;try{n=JSON.parse(e)}catch(r){n=t}return n}function KvPair(e){return e=isKvPair(e)||isKvPair(e=hpJsonParse(e))?e:{}}function isFunction(e){return"function"==typeof e}function param(e){var n=[];function i(e,t){null!=e&&""!==e&&(t=null==(t=isFunction(t)?t():t)?"":t,n[n.length]=$encodeURIComponent(e)+"="+$encodeURIComponent(t))}return function a(e,t){var n,r;if(e)switch(getType(t)){case $ArrayTypeNameBig:for(n=0;n<t.length;n++)a(e+"["+("object"==typeof t[n]&&t[n]?n:"")+"]",t[n]);break;case $ObjectTypeNameBig:for(r in t)a(e+"["+r+"]",t[r]);break;default:i(e,t)}else switch(getType(t)){case $stringTypeNameBig:case $ObjectTypeNameBig:for(r in t)a(r,t[r]);break;case $ArrayTypeNameBig:for(n=0;n<t.length;n++)i(t[n].name,t[n].value)}}("",e),n.join("&")}function urlToGet(e,t){e=_String(e).replace(/&*$/g,"").replace(/\?*$/,"");var n="";return(n=isKvPair(t)||isArray(t)?param(t):_String(t).replace(/^&*/,""))&&(e+=(/\?/.test(e)?"&":"?")+n),e}var baseReg="["+$regSpaceStr+"]+";function trim(e,t){var n=getType(e),r=(n===$numberTypeNameBig&&(e=String(e),n=$stringTypeNameBig),"");if(n!==$stringTypeNameBig)return"";switch(t){case 1:r="^"+baseReg;break;case-1:r=baseReg+"$";break;case"*":r=baseReg;break;default:r="^"+baseReg+"|"+baseReg+"$"}return e.replace(new RegExp(r,"g"),"")}function isString(e){return getType(e)===$stringTypeNameBig}function hpIsEmptyMap(e){var t,n=!0;for(t in e)if(t!==undefined){n=!1;break}return n}function clean(e,t,n){if(n=!1!==n,isKvPair(e)){var r,i,a={};for(i in e)_filterData(isArray(r=e[i])||isKvPair(r)?clean(r,t):r,t,n,function(e){a[i]=e})}else if(isArray(e)){a=[];for(var o=0,u=e.length;o<u;o++)_filterData(clean(e[o],t),t,n,function(e){a.push(e)})}else a=e;return a}function _filterData(e,t,n,r){isString(e)?t&&""==trim(e,"*")||r(e):null!=e&&(n&&isKvPair(e)&&hpIsEmptyMap(e),r(e))}function cloneEasy(e){switch(getType(e)){case $ArrayTypeNameBig:for(var t=[],n=0;n<e.length;n++)t.push(cloneEasy(e[n]));break;case $ObjectTypeNameBig:for(var r in t={},e)t[r]=cloneEasy(e[r]);break;case $FunctionTypeNameBig:function i(){e.apply(this,arguments)}for(var a in e.prototype)i.prototype[a]=e.prototype[a];t=i;break;default:t=e}return t}function isNoData(e,t){var n=!1;return n=isArray(e)&&t.array&&0===e.length||isKvPair(e)&&t.kvPair&&hpIsEmptyMap(e)||isString(e)&&t.string&&""===e||isNull(e)?!0:n}function hander(e,t){if(isKvPair(e))for(var n in e){var r=e[n];(isArray(r)||isKvPair(r))&&hander(r,t),isNoData(r,t)&&delete e[n]}}function shake(e,t){t=Object.assign({string:!0,array:!0,kvPair:!0},t);return hander(e=cloneEasy(e),t),e}function _Array(e){return e=isArray(e)||isArray(e=hpJsonParse(e))?e:[]}function variableHasValue(e,t,n){var r;n=null==n?60:n,e()?t():(clearTimeout(r),setTimeout(function(){variableHasValue(e,t,n)},n))}variableHasValue["async"]=function(t,n){return new Promise(function(e){variableHasValue(t,e,n)})};var _tmp={};function dataCacheUtil(e){_tmp[e]=_tmp[e]||{count:0,complete:!1,data:null};var t=_tmp[e];return t.count++,{isExist:function(){return 1<t.count},set:function(e){t.complete=!0,t.data=JSON.stringify(e)},get:function(e){variableHasValue(function(){return t.complete},function(){e(hpJsonParse(t.data))},100)},logs:_tmp}}var DEFAULT_CONFIG={id:"id",children:"children"};function deepFindTreePath(e,t,n){n=Object.assign(DEFAULT_CONFIG,n);for(var r=[],i=cloneEasy(e),a=new Set,o=n["children"];i.length;){var u=i[0];if(a.has(u))r.pop(),i.shift();else if(a.add(u),u[o]&&i.unshift.apply(i,u[o]),r.push(u),t(u))return r}return undefined}function _Number(e){return(e=Number(e))===Math.abs(Infinity)||isNaN(e)?0:e}function defaultValue(e,t){return isNull(e)?t:e}function repeatString(e,t){var n="";if((e=_String(e)).length*t<1<<28)for(;1==(1&t)&&(n+=e),0!=(t>>>=1);)e+=e;return n}function hpPadString(e,t,n,r){return(e=_String(e)).length>(t>>=0)?e:(t-=e.length,n.length<t&&(n+=repeatString(n,t/n.length)),-1===r?n.slice(0,t)+e:e+n.slice(0,t))}function padStart(e,t,n){return hpPadString(e,t,n,-1)}function padEnd(e,t,n){return hpPadString(e,t,n,1)}function split(e,t){return""!==e?e.split(t):[]}function floorFixed(e,t,n){var e=split(e=trim(_Number(e)),"."),r=e[1]||"";return r.length<t&&(r=padEnd(r,t,$zeroString),n&&(r=r.replace(/0+$/,""))),t<1||!r?e[0]:e[0]+"."+r.substring(0,t)}function roundFixed(e,t,n){e=_Number(e);var r,i=Math.pow(10,t),e=_String(Math.round(e*i)/i);return 0<t&&(r=(i=split(e,"."))[0],(i=i[1]||"").length<t&&(i=padEnd(i,t,$zeroString),e=(i=n?i.replace(/0+$/,""):i)?r+"."+i:r)),e}function deepFindItem(e,n,t){var r,i,a=isNull(t)?"children":t;return function o(e){if(e)for(var t=0;t<e.length;t++){if(i=n(e[t])){r=e[t];break}if(o(e[t][a]),i)break}}(e),r}function flatArrayToTree(e,t){for(var n=(t=KvPair(t)).id||"id",r=t.pid||"pid",i=t.children||"children",a=0;a<e.length;a++){var o,u=e[a];(o=deepFindItem(e,function(e){return null!=e[n]&&e[n]!=u[n]&&e[n]===u[r]},i))&&(o[i]=_Array(o[i]),o[i].push(u),e.splice(a--,1))}return e}function changeIndex(e,t,n){if(e<0)return t;e+=1;return(t=(t+n)%e)<0&&(t+=e),-0===t?0:t}function zeroTo2(e){return padStart(e,2,"0")}function formatFunc(e,t,n){var r=e[t];return e[t]===undefined||null===e[t]?"":zeroTo2(n)+r}function handleOne(e,t){for(var n=e.split[0],r=t.split[1],i=0;i<n.length&&n[i]===r[i];i++)r[i]=""}function timeLine(e,t){t=t||["年","月","日 ","时","分","秒","毫秒"];for(var n,r=[],i=0;i<e.length;i++){var a,o=[formatFunc(t,0,(a=new Date(e[i])).getFullYear()),formatFunc(t,1,a.getMonth()+1),formatFunc(t,2,a.getDate()),formatFunc(t,3,a.getHours()),formatFunc(t,4,a.getMinutes()),formatFunc(t,5,a.getSeconds()),formatFunc(t,6,a.getMilliseconds())];r.push({value:e[i],timestamp:+a,split:[o,cloneEasy(o)]})}r.sort(function(e,t){return e.millisecond-t.millisecond});for(i=1;i<r.length;i++)handleOne(r[i-1],r[i]);for(i=0;i<r.length;i++)(n=r[i]).split=n.split[1],n.label=trim(n.split.join(""));return r}function getRandom(e,t,n){n=!1===n?0:1;return e=Math.random()*(t-e+n)+e,n?Math.floor(e):e}function getRandomWord(){return $letters[getRandom(0,$letters.length-1)][0]}function uuid(e){e=_Number(e);for(var t="",n=0;n<13;n++)t+=getRandom(1,9);e=(new Date).getTime()*getRandom(1,100);return padEnd(getRandomWord()+Number(t).toString(32)+e.toString(32),20,getRandomWord()+getRandomWord()+getRandomWord())}function _Boolean(e){return!0===e||"true"===e||"1"===e||1===e}function flatTree(e,r){var i=[];return r=defaultValue(r,"children"),function a(e){if(isArray(e))for(var t,n=0;n<e.length;n++)t=e[n],i.push(t),a(t[r])}(e),i}function main(e,r,i,a){a=a||"children";var t=[];return function o(e,t){for(var n=0;n<e.length;n++)t[n]=cloneEasy(i(e[n])),e[n][a]&&(t[n][r]=[],o(e[n][a],t[n][r]))}(e,t),t}var events={};function defineEventBus(i){if(events[i])throw'"'+i+'" Has already been registered!';return events[i]=events[i]||[],{on:function(e){events[i].push(e)},emit:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];for(var r=0;r<events[i].length;r++)events[i][r].apply($undefinedValue,t)},off:function(e){if(!e)throw"the hander of off is required!";for(var t=0;t<events[i].length;t++)events[i][t]===e&&events[i].splice(t--,1)},dispose:function(){for(var e=0;e<events[i].length;e++)events[i].splice(e--,1);delete events[i]}}}function forEachTree(e,n,r){r=r||"children",function i(e){for(var t=0;t<e.length;t++)n(e[t]),isArray(e[t][r])&&i(e[t][r])}(e)}function randomColor(){return"rgba("+getRandom(0,255,!0)+","+getRandom(0,255,!0)+","+getRandom(0,255,!0)+",1)"}function emptyFunc(e,t){}var Polling=function(){function e(e){this._timer=void 0,this._timer_info=void 0,this._stamp=0,this._passStamp=0,this._option=void 0,this._option=Object.assign({timeout:6e3,interval:1e3,handler:emptyFunc},e),this._next=this._next.bind(this),this._doOnce=this._doOnce.bind(this),this.done=this.done.bind(this)}var t=e.prototype;return t._next=function(){return clearInterval(this._timer),this._passStamp=+new Date-this._stamp,this._timer=setTimeout(this._doOnce,this._option.interval),this},t._doOnce=function(){if(this._passStamp>=this._option.timeout)return this._option.onMessage&&this._option.onMessage(0),this.done(),this;this._option.handler(this._next,this.done)},t.start=function(){var e,t=this;this._stamp=+new Date,this.done(),this._doOnce();return this._option.onMessage&&(clearInterval(this._timer_info),this._timer_info=setInterval(function(){e=+new Date-t._stamp,0===(e=Math.max(t._option.timeout-e,0))&&t.done(),t._option.onMessage(e)},100)),this},t.done=function(){return clearTimeout(this._timer),clearTimeout(this._timer_info),this},t.dispose=function(){return this.done(),this},e}();function dataPage(e,t,n){if(n<1)throw"页码必须大于0";var r=(n-1)*t,i=r+t;return{current:n,total:e.length,size:t,pages:Math.ceil(e.length/t),data:cloneEasy(e.slice(r,i))}}function setObjectToString(e){return e=isString(e)?e:JSON.stringify(e)}function setCookie(e,t,n){t=setObjectToString(t);e=e+"="+encodeURI(t)+";path=/;";"number"==typeof n&&((t=new Date).setTime(t.getTime()+n),e+="expires="+t.toUTCString()),document.cookie=e}function getCookie(e,t){t=t||document.cookie;var r="";return t.replace(new RegExp("(^|;\\s)"+e+"=(.*?)($|(;\\s))"),function(e,t,n){r=$decodeURIComponent(n)}),r}function removeCookie(e){setCookie(e,"",-1)}function hpTryToParseStringToBasicType(e){return null==e?undefined:$falseString!==e&&($trueString===e||hpJsonParse(e,e))}var defaultSplitArr=[$undefinedValue,$undefinedValue];function handleDeepKey(e,t,n){var t=splitSymbol(t),r=t[0];isPreLikeArray(r)?(r=_Number(r),t[1]==$undefinedValue?e.push(n):(/^\[[\D]+\]/.test(t[1])?e[r]=KvPair(e[r]):e[r]=_Array(e[r]),handleDeepKey(e[r],t[1],n))):t[1]==$undefinedValue?e[r]=n:(/^\[[\D]+\]/.test(t[1])?e[r]=KvPair(e[r]):e[r]=_Array(e[r]),handleDeepKey(e[r],t[1],n))}function splitSymbol(e){if(e==$undefinedValue)return defaultSplitArr;var r,i=e;return e.replace(/^\[(.*?)\](.*)?/,function(e,t,n){return i=t,r=n,""}),[i,r]}function isPreLikeArray(e){return""===e||/^\d+$/.test(e)}function parseQuery(e){var a,n,o={};return(e=e||$isBroswer&&$browserGlobal.location.href||"").replace(/([^=&?/#]*?)=([^=&?/#]*)/g,function(e,t,i){i=hpTryToParseStringToBasicType($decodeURIComponent(i)),n=$decodeURIComponent(t),a=!1,""!==n&&(n.replace(/(.*?)(\[.*)/,function(e,t,n){var r=splitSymbol(n);a=!0,isPreLikeArray(r[0])?o[t]=_Array(o[t]):o[t]=KvPair(o[t]),handleDeepKey(o[t],n,i)}),a||(o[n]=i))}),o}function downloadFileByUrl(e,t){var n=document.createElement("a");n.style.display="none",n.download=t,n.setAttribute("href",e),n.setAttribute("target","_blank"),n.setAttribute("download",t),document.body.appendChild(n),n.click(),n.remove()}function downloadFileByArrayBuffer(e,t){var n;$isBroswer&&(downloadFileByUrl(e=(n=$browserGlobal.URL).createObjectURL(new Blob([e])),t),n.revokeObjectURL(e),undefined)}function removeElement(e){e.parentNode&&e.parentNode.removeChild(e)}function prevent(e,t,n){$isBroswer&&(e=e||$browserGlobal.event,n=!1!==n,(t=!1!==t)&&$browserGlobal.event?$browserGlobal.event.cancelBubble=!0:e.stopPropagation(),n&&$browserGlobal.event?$browserGlobal.event.returnValue=!1:e.preventDefault())}function getStorage(e){return defaultValue(localStorage.getItem(e),"")}function removeStorage(e){localStorage.removeItem(e)}function hpSetStringValue(e){return e=isString(e)?e:JSON.stringify(e)}function setStorage(e,t){localStorage.setItem(e,hpSetStringValue(t))}function getRelativePos(e){var t=e.getBoundingClientRect();return{x:t.left,y:t.top,height:e.offsetHeight,width:e.offsetWidth,clientWidth:e.clientWidth,clientHeight:e.clientHeight}}function getJsFileBaseUrl(e){e=e||0;for(var t="/[^/]*",n=document.scripts,r=0;r<e;r++)t+=t;return n[n.length-1].src.replace(new RegExp(t+"$"),"")}function hpCreateFileLoaderElement(e,t,n,r){if($headElement){var i;if("js"===e?(i=document.createElement("script")).src=t:((i=document.createElement("link")).setAttribute("rel","stylesheet"),i.href=t),r)for(var a in r)i.setAttribute(a,r[a]);i.onload=i.onerror=n,$headElement.appendChild(i)}}var cache={};function loadMultiple(n,r){for(var i=[],a=0,e=0;e<n.length;e++)!function(t){loadSingle(n[t],function(e){i[t]=e,++a===n.length&&r.apply($undefinedValue,i)})}(e)}function loadSingle(e,t){var n=e.dependencies&&e.dependencies.length,r=e["with"]&&e["with"].length,i=(cache[e.url]||(cache[e.url]={count:0,dependencies:!n,"with":!r,complete:!1,create:!1,url:e.url}),cache[e.url]);function a(){i.complete&&i.dependencies&&i["with"]&&(e.module?t($browserGlobal[e.module]):t())}i.count++,!i.dependencies&&n?(i.dependencies=!0,loadMultiple(e.dependencies,function(){loadSingle(e,t)})):!i["with"]&&r?(i["with"]=!0,loadMultiple(e["with"].concat(e),a)):i.create?variableHasValue(function(){return i.complete},a,300):(i.create=!0,hpCreateFileLoaderElement(e.type,e.url,function(){i.complete=!0,a()},e.attribute))}function libraryFile(e,t){console.log("加载器",e,cache),(e instanceof Array?loadMultiple:loadSingle)(e,t)}var timer,htivId=0,idName="",isStart=!1,records={};function stop(){isStart=!1,clearInterval(timer),timer=undefined}function startRun(){clearInterval(timer),isStart=!0,timer=setInterval(function(){for(var e in records){var t=records[e];t.current=+new Date,t.current-t.start>=t.interval&&(t.start=t.current,records[e].handler())}},17)}function add(e,t){return idName="HI-"+ ++htivId,records[idName]={start:+new Date,current:0,handler:e,interval:t},isStart||startRun(),idName}function remove(e){delete records[e],hpIsEmptyMap(records)&&stop()}var hpInterval={add:add,remove:remove};function observeDomResize(n,r,i,e){var a=[0,0,!1],o=[0,0,!1],u=[0,0,!1],l=[0,0,!1],t=hpInterval.add(s,e=e||500);function s(){var e,t;document.body.contains(n)?(e=!1,null!=i&&i.includes("position")&&(t=n.getBoundingClientRect(),u[0]=t.left,u[2]=u[0]!==u[1],l[0]=t.top,l[2]=l[0]!==l[1]),a[0]=n.offsetWidth,a[2]=a[0]!==a[1],o[0]=n.offsetHeight,o[2]=o[0]!==o[1],a[2]&&(a[1]=a[0],null!=i&&i.includes("width")&&(e=!0)),o[2]&&(o[1]=o[0],null!=i&&i.includes("height")&&(e=!0)),(l[2]||u[2])&&(l[1]=l[0],u[1]=u[0],null!=i&&i.includes("position")&&(e=!0)),i&&0!==i.length||(a[2]||o[2]||l[2]||u[2])&&(e=!0),e&&r(n)):c()}function c(){hpInterval.remove(t),a=undefined,o=undefined}return s(),c}function getWindowSize(){return{width:document.documentElement.clientWidth||document.body.clientWidth||window.innerWidth||0,height:document.documentElement.clientHeight||document.body.clientHeight||window.innerHeight||0}}export{Polling,_Array,_Boolean,KvPair as _KvPair,_Number,_String,changeIndex,clean,cloneEasy,dataCacheUtil,dataPage,deepFindItem,deepFindTreePath,defaultValue,defineEventBus,downloadFileByArrayBuffer,downloadFileByUrl,flatTree,floorFixed,forEachTree,getCookie,getJsFileBaseUrl,getRandom,getRelativePos,getStorage,getType,getWindowSize,isArray,isFunction,isKvPair,isNull,libraryFile,main as mapTree,observeDomResize,padEnd,padStart,param,parseQuery,prevent,randomColor,removeCookie,removeElement,removeStorage,repeatString,roundFixed,setCookie,setStorage,shake,split,timeLine,flatArrayToTree as tree,trim,urlToGet,uuid,variableHasValue};
