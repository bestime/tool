/**
 * 纯JS工具库 => jUtilsBase
 * @update 2024-08-27 10:15:09
 */
var $letters=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"],$ArrayTypeNameBig="Array",$ClassTypeNameBig="Class",$FunctionTypeNameBig="Function",$ObjectTypeNameBig="Object",$stringTypeNameBig="String",$numberTypeNameBig="Number",$undefinedValue=void 0,$zeroString="0",$falseString="false",$trueString="true",$ObjectTypeNameBigPrototypeToString=Object.prototype.toString,$encodeURI=encodeURI,$decodeURIComponent=decodeURIComponent,$regSpaceStr="\\s\\uFEFF\\xA0",$zeroWidthCode="‎";function isNull(e){return null===e||e===$undefinedValue}function _String(e){return isNull(e)?"":String(e)}var smallFunName=$FunctionTypeNameBig.toLowerCase();function isFunction(e){return typeof e===smallFunName}function isClass(e){return isFunction(e)&&/^class\s/.test(Function.prototype.toString.call(e))}function getType(e){return isClass(e)?$ClassTypeNameBig:$ObjectTypeNameBigPrototypeToString.call(e).slice(8,-1)}function isArray(e){return getType(e)===$ArrayTypeNameBig}function isKvPair(e){return getType(e)===$ObjectTypeNameBig}function isString(e){return getType(e)===$stringTypeNameBig}function hpJsonParse(e,n){var t;try{t=JSON.parse(e)}catch(r){t=n}return t}function _KvPair(e){return e=isKvPair(e)||isKvPair(e=hpJsonParse(e))?e:{}}function isEmpty(e){return isNull(e)||""===e}function param(e){var t=[];function i(e,n){null!=e&&""!==e&&(n=null==(n=isFunction(n)?n():n)?"":n,t[t.length]=$encodeURI(e)+"="+$encodeURI(n))}return function a(e,n){var t,r;if(e)switch(getType(n)){case $ArrayTypeNameBig:for(t=0;t<n.length;t++)a(e+"["+("object"==typeof n[t]&&n[t]?t:"")+"]",n[t]);break;case $ObjectTypeNameBig:for(r in n)a(e+"["+r+"]",n[r]);break;default:i(e,n)}else switch(getType(n)){case $stringTypeNameBig:case $ObjectTypeNameBig:for(r in n)a(r,n[r]);break;case $ArrayTypeNameBig:for(t=0;t<n.length;t++)i(n[t].name,n[t].value)}}("",e),t.join("&")}function _Array(e){return e=isArray(e)||isArray(e=hpJsonParse(e))?e:[]}function isNumber(e){return getType(e)===$numberTypeNameBig}var baseReg="["+$regSpaceStr+"]+";function trim(e,n){var t=getType(e),r=(t===$numberTypeNameBig&&(e=String(e),t=$stringTypeNameBig),"");if(t!==$stringTypeNameBig)return"";switch(n){case 1:r="^"+baseReg;break;case-1:r=baseReg+"$";break;case"*":r=baseReg;break;default:r="^"+baseReg+"|"+baseReg+"$"}return e.replace(new RegExp(r,"g"),"")}function _Number(e){var n=!1,t=0,t=isNumber(e)?e:(isString(e)&&(e=trim(e,"*").replace(/,/g,"").replace(/%$/,function(e){return n=!0,""})),Number(e));return t=Math.abs(t)===Math.abs(Infinity)||isNaN(t)?0:t,n&&(t/=100),t}function hpTryToParseStringToBasicType(e){return null==e?$undefinedValue:$falseString!==e&&($trueString===e||hpJsonParse(e,e))}var defaultSplitArr=[$undefinedValue,$undefinedValue];function handleDeepKey(e,n,t){var n=splitSymbol(n),r=n[0];isPreLikeArray(r)?(r=_Number(r),n[1]==$undefinedValue?e.push(t):(/^\[[\D]+\]/.test(n[1])?e[r]=_KvPair(e[r]):e[r]=_Array(e[r]),handleDeepKey(e[r],n[1],t))):n[1]==$undefinedValue?e[r]=t:(/^\[[\D]+\]/.test(n[1])?e[r]=_KvPair(e[r]):e[r]=_Array(e[r]),handleDeepKey(e[r],n[1],t))}function splitSymbol(e){if(e==$undefinedValue)return defaultSplitArr;var r,i=e;return e.replace(/^\[(.*?)\](.*)?/,function(e,n,t){return i=n,r=t,""}),[i,r]}function isPreLikeArray(e){return""===e||/^\d+$/.test(e)}function parseQuery(e){var a={},o=!1,t="";return(e=isNull(e)?"":e).replace(/([^=&?/#]*?)=([^=&?/#]*)/g,function(e,n,i){i=hpTryToParseStringToBasicType($decodeURIComponent(i)),t=$decodeURIComponent(n),o=!1,""!==t&&(t.replace(/(.*?)(\[.*)/,function(e,n,t){var r=splitSymbol(t);o=!0,isPreLikeArray(r[0])?a[n]=_Array(a[n]):a[n]=_KvPair(a[n]),handleDeepKey(a[n],t,i)}),o||(a[t]=i))}),a}function urlToGet(e,n){e=_String(e);var a=isKvPair(n)?n:parseQuery(n),n=parseQuery(e=e.replace(/({{)(.*?)(}})/g,function(e,n,t,r){t=trim(t);var i=a[t];return delete a[t],i})),n=param(a=Object.assign(n,a));return e=n?(e=e.replace(/\?.*/,""))+"?"+n:e}function hpIsEmptyMap(e){var n,t=!0;for(n in e)if(n!==$undefinedValue){t=!1;break}return t}function forEach(e,n){for(var t=0;t<e.length;t++)n(e[t],t,e)}function cloneEasy(n){switch(getType(n)){case $ClassTypeNameBig:t=Object.assign(Object.create(Object.getPrototypeOf(n)),n);break;case $ArrayTypeNameBig:for(var t=[],e=0;e<n.length;e++)t.push(cloneEasy(n[e]));break;case $ObjectTypeNameBig:t={},forEach(Object.keys(n),function(e){t[e]=cloneEasy(n[e])});break;case $FunctionTypeNameBig:function r(){n.apply(this,arguments)}for(var i in n.prototype)r.prototype[i]=n.prototype[i];t=r;break;default:t=n}return t}function isNoData(e,n){var t=!1;return t=isArray(e)&&n.array&&0===e.length||isKvPair(e)&&n.kvPair&&hpIsEmptyMap(e)||isString(e)&&n.string&&""===e||isNull(e)?!0:t}function hander(e,n){if(isKvPair(e))for(var t in e){var r=e[t];(isArray(r)||isKvPair(r))&&hander(r,n),isNoData(r,n)&&delete e[t]}}function shake(e,n){n=Object.assign({string:!0,array:!0,kvPair:!0},n);return hander(e=cloneEasy(e),n),e}function variableHasValue(e,n,t){var r;t=null==t?60:t,e()?n():(clearTimeout(r),setTimeout(function(){variableHasValue(e,n,t)},t))}variableHasValue["async"]=function(n,t){return new Promise(function(e){variableHasValue(n,e,t)})};var DEFAULT_CONFIG={id:"id",children:"children"};function deepFindTreePath(e,n,t){t=Object.assign(DEFAULT_CONFIG,t);for(var r=[],i=cloneEasy(e),a=new Set,o=t["children"];i.length;){var u=i[0];if(a.has(u))r.pop(),i.shift();else if(a.add(u),u[o]&&i.unshift.apply(i,u[o]),r.push(u),n(u))return r}return undefined}var regStr=/(-|\+)?((\d+)|((\d,?)+\d+))(\.?\d+)?%?/.toString().replace(/(^\/)|(\/$)/g,"");function getLikeNumberRegExp(){return regStr}function isLikeNumber(e){e=trim(e);return new RegExp("^"+regStr+"$").test(e)}function repeatString(e,n){var t="";if((e=_String(e)).length*n<1<<28)for(;1==(1&n)&&(t+=e),0!=(n>>>=1);)e+=e;return t}function hpPadString(e,n,t,r){return(e=_String(e)).length>(n>>=0)?e:(n-=e.length,t.length<n&&(t+=repeatString(t,n/t.length)),-1===r?t.slice(0,n)+e:e+t.slice(0,n))}function padStart(e,n,t){return hpPadString(e,n,t,-1)}function padEnd(e,n,t){return hpPadString(e,n,t,1)}function split(e,n){return""!==e?e.split(n):[]}function floorFixed(e,n,t){var e=split(e=trim(_Number(e)),"."),r=e[1]||"";return r.length<n&&(r=padEnd(r,n,$zeroString),t&&(r=r.replace(/0+$/,""))),n<1||!r?e[0]:e[0]+"."+r.substring(0,n)}function roundFixed(e,n,t){e=_Number(e);var r,i=Math.pow(10,n),e=_String(Math.round(e*i)/i);return 0<n&&(r=(i=split(e,"."))[0],(i=i[1]||"").length<n&&(i=padEnd(i,n,$zeroString),e=(i=t?i.replace(/0+$/,""):i)?r+"."+i:r)),e}function deepFindItem(e,t,n){var r,i,a=isNull(n)?"children":n;return function o(e){if(e)for(var n=0;n<e.length;n++){if(i=t(e[n])){r=e[n];break}if(o(e[n][a]),i)break}}(e),r}function flatArrayToTree(e,n){for(var t=(n=_KvPair(n)).id||"id",r=n.pid||"pid",i=n.children||"children",a=0;a<e.length;a++){var o,u=e[a];(o=deepFindItem(e,function(e){return null!=e[t]&&e[t]!=u[t]&&e[t]===u[r]},i))&&(o[i]=_Array(o[i]),o[i].push(u),e.splice(a--,1))}return e}function changeIndex(e,n,t){if(e<0)return n;e+=1;return(n=(n+t)%e)<0&&(n+=e),-0===n?0:n}function getRandom(e,n,t){t=!1===t?0:1;return e=Math.random()*(n-e+t)+e,t?Math.floor(e):e}function getRandomWord(){return $letters[getRandom(0,$letters.length-1)][0]}function uuid(e){e=_Number(e);for(var n="",t=0;t<13;t++)n+=getRandom(1,9);e=(new Date).getTime()*getRandom(1,100);return padEnd(getRandomWord()+Number(n).toString(32)+e.toString(32),20,getRandomWord()+getRandomWord()+getRandomWord())}function _Boolean(e){return!0===e||"true"===e||"1"===e||1===e}function main(e,i,a,o){o=o||"children";var n=[];return function u(e,n){for(var t=0;t<e.length;t++){var r=a(e[t]);isNull(r)||(n[t]=cloneEasy(r),e[t][o]&&(n[t][i]=[],u(e[t][o],n[t][i])))}}(e,n),n}var events={};function defineEventBus(i){if(events[i])throw'"'+i+'" Has already been registered!';return events[i]=events[i]||[],{on:function(e){events[i].push(e)},emit:function(){for(var e=arguments.length,n=new Array(e),t=0;t<e;t++)n[t]=arguments[t];for(var r=0;r<events[i].length;r++)events[i][r].apply($undefinedValue,n)},off:function(e){if(!e)throw"the hander of off is required!";for(var n=0;n<events[i].length;n++)events[i][n]===e&&events[i].splice(n--,1)},dispose:function(){for(var e=0;e<events[i].length;e++)events[i].splice(e--,1);delete events[i]},eventList:function(){return events[i]}}}function forEachTree(e,i,a){a=a||"children",function o(e,n){for(var t=0;t<e.length;t++){var r=cloneEasy(n);i(e[t],r),isArray(e[t][a])&&(r.push(e[t]),o(e[t][a],r))}}(e,[])}function randomColor(){return"rgba("+getRandom(0,255,!0)+","+getRandom(0,255,!0)+","+getRandom(0,255,!0)+",1)"}function emptyFunc(e,n){}var Polling=function(){function e(e){this._timer=void 0,this._timer_info=void 0,this._stamp=0,this._passStamp=0,this._option=void 0,this._option=Object.assign({timeout:6e3,interval:1e3,handler:emptyFunc},e),this._next=this._next.bind(this),this._doOnce=this._doOnce.bind(this),this.done=this.done.bind(this)}var n=e.prototype;return n._next=function(){return clearInterval(this._timer),this._passStamp=+new Date-this._stamp,this._timer=setTimeout(this._doOnce,this._option.interval),this},n._doOnce=function(){if(this._passStamp>=this._option.timeout)return this._option.onMessage&&this._option.onMessage(0),this.done(),this;this._option.handler(this._next,this.done)},n.start=function(){var e,n=this;this._stamp=+new Date,this.done(),this._doOnce();return this._option.onMessage&&(clearInterval(this._timer_info),this._timer_info=setInterval(function(){e=+new Date-n._stamp,0===(e=Math.max(n._option.timeout-e,0))&&n.done(),n._option.onMessage(e)},100)),this},n.done=function(){return clearTimeout(this._timer),clearTimeout(this._timer_info),this},n.dispose=function(){return this.done(),this},e}();function dataPage(e,n,t){if(t<1)throw"页码必须大于0";var r=(t-1)*n,i=r+n;return{current:t,total:e.length,size:n,pages:Math.ceil(e.length/n),data:cloneEasy(e.slice(r,i))}}function basicCheck(e,n,t,r){if(e="【"+e+"】",t&&isEmpty(n))throw"字段"+e+"不能为空";if(getType(n)!==r)switch(r){case"String":n=String(n);break;case"Number":if(!isLikeNumber(n))throw"字段"+e+"必须为数字";n=Number(n)}return n}var fieldCheck={number:function(e,n){return basicCheck(e,n,!(2<arguments.length&&arguments[2]!==undefined)||arguments[2],"Number")},string:function(e,n){return basicCheck(e,n,2<arguments.length&&arguments[2]!==undefined&&arguments[2],"String")}};function uniq(e){return Array.from(new Set(e))}var defaultSortFun=function(e,n){return Number(e)-Number(n)},_names_count=0,_namesMap={};function getIdMap(e){return _namesMap[e]||(_namesMap[e]={id:++_names_count,label:e}),_namesMap[e]}function createUniqIds(e,n){var t=[],r=[];return e.forEach(function(e){e=getIdMap(n[e]);t.push(e.id),r.push(e.label)}),{id:t.join("_"),label:r.join("→")}}function arrayRowToColumn(e,i){var n,t=[],a=(e.forEach(function(e){e=String(e[i.colField]);t.includes(e)||t.push(e)}),t.sort(null!=(r=i.colSort)?r:defaultSortFun),{}),f=(e.forEach(function(n){var e=createUniqIds(i.uniqueRowId,n),t={},r=(i.uniqueRowId.forEach(function(e){t[e]=n[e]}),a[e.id]=a[e.id]||{value:t,name:e.label,data:{}},i.colCreate(n[i.colField]).field);a[e.id].data[r]=a[e.id].data[r]||[],a[e.id].data[r].push(n)}),[]);for(n in a)f.push({name:a[n].name,value:a[n].value,data:a[n].data,summary:{}});var r=t.map(function(e){var n=i.colCreate(e);return{value:e,label:n.label,field:n.field}}),d={};return i.summaryConfig&&(i.summaryConfig.row&&(f=mergeRowSummary(f,i.summaryConfig.row,i.summaryConfig.averageField)),i.summaryConfig.column&&(d=mergeColSummary(f,i.summaryConfig.column,i.summaryConfig.averageField))),{columns:r,data:f,colSummary:d,getExtRow:function(n,e,t){var r,i=f.find(function(e){return e.name===n}),a={};if(!i){var o=e,u=t,c=d[n],s={};if(c)for(var l in c)s[l]=u(c[l][o]);return s}for(r in i.summary)a[r]=t(i.summary[r][e]);return a}}}function getZengzhngl(e,n){return e===$undefinedValue||n===$undefinedValue?$undefinedValue:(n-e)/Math.abs(e)}function mergeRowSummary(i,a,n){return i.forEach(function(c){var s=a[c.name];if(s){var l,e,f=0,d=0;for(e in c.data)!function(e){d++;var n,t=[],r=0,i=[],a=[],o=(c.data[e].forEach(function(e){isNumber(s.count)||t.push(e[s.count.field]);var n=_Number(e[s.value.field]);switch(s.value.mode){case"uniqLength":i.push(e[s.value.field]),i=uniq(i),r=i.length;break;case"sum":case"avg":r+=n}0!==n&&a.push(n)}),0);if(isNumber(s.count))o=s.count;else switch(s.count.mode){case"length":o=t.length;break;case"uniqLength":o=uniq(t).length;break;case"notZeroValue":o=a.length}var u=r;"avg"===s.value.mode&&(u=r/o),f+=u,c.summary[e]={value:u,proportion:0,riseRatio:l?getZengzhngl(null==(n=c.summary[l])?void 0:n.value,u):void 0},l=e}(e);c.summary[n]={value:f/d,riseRatio:$undefinedValue,proportion:0}}}),i.forEach(function(e){var n=a[e.name];if(n){var t=i.find(function(e){return e.name===n.proportionBaseField});if(n.proportionBaseField&&t)for(var r in e.summary)e.summary[r].proportion=e.summary[r].value/t.summary[r].value}}),i}function mergeColSummary(s,l,f){var e,d={},m={},n=function(i){m[i]={},d[i]={};var e,a=l[i],n=(s.forEach(function(r){for(var e in r.data)!function(e){d[i][e]=d[i][e]||{data:[],sum:0};var n=[],t=0;switch(r.data[e].forEach(function(e){switch(n.push(e[a.field]),a.mode){case"uniqLength":n=uniq(n);break;case"avg":case"sum":t+=e[a.field];break;case"notZeroLength":0!==_Number(e[a.field])&&t++}}),a.mode){case"uniqLength":n=uniq(n);break;case"avg":t/=r.data[e].length}d[i][e].data=d[i][e].data.concat(n),d[i][e].sum+=t}(e)}),void 0);for(e in d[i]){var t,r=0;switch(a.mode){case"avg":r=d[i][e].sum/s.length;break;case"uniqLength":r=uniq(d[i][e].data).length;break;case"notZeroLength":case"sum":r=d[i][e].sum}m[i][e]={value:r,proportion:0,riseRatio:n?getZengzhngl(null==(t=m[i][n])?void 0:t.value,r):void 0},n=e}var o,u=0,c=0;for(o in m[i])u+=m[i][o].value,c++;m[i][f]={value:u/c,riseRatio:$undefinedValue,proportion:0}};for(e in l)n(e);return m}function sameRowCellCount(e,n,t,r){var i=1;for(e++;e<r.length;e++){var a=r[e][n];if(a!==t&&!isEmpty(a))break;i++}return i}function findPrevRowSpanNum(e,n,t){for(var r=0;0<=n&&!(0<(r=e[n].$rowSpan[t]));n--);return r}function sameColSellCount(e,n,t,r){var i=1;for(e++;e<r.length;e++){var a=trim(t[r[e]]);if(a!==n&&!isEmpty(a))break;i++}return i}function spanTable(e,u){var c=cloneEasy(e),s={};return u.forEach(function(e,n){var i,a,o;i=e,a=u[n-1],o=0,c.forEach(function(e,n){e.$rowSpan=null!=(r=e.$rowSpan)?r:{};var t,r=e[i];s[i]=null!=(t=s[i])?t:0,1<s[i]?(e.$rowSpan[i]=0,s[i]--):(t=sameRowCellCount(n,i,r,c),void 0!==a&&(r=findPrevRowSpanNum(c,n,a),0<o?r<=o+t?(t=r-o,o=0):o+=t:t<r?o=t:t=r),s[i]=t,e.$rowSpan[i]=s[i])})}),c.forEach(function(r){r.$colField={};var i=0;u.forEach(function(e,n){var t=r[e];1<i?(r.$colField[e]=0,i--):(i=sameColSellCount(n,t,r,u),r.$colField[e]=i)})}),c}function thousands(e,i,a){return i=i||3,a=a||",",(isString(e)?e:_String(e)).replace(/([^.]*)?(\.)?(.*)?/,function(e,n,t,r){return _String(n).replace(new RegExp("(.(?=(.{"+i+"})+$))","g"),"$1"+a)+_String(t)+_String(r)})}function mapKvPair(e,n){var t,r={};for(t in e)r[t]=n(cloneEasy(e[t]),t);return r}function isFuzzyMatch(e,n,t){var r=!0;return(e=trim(e,"*"))&&(e=split(e,"").join(".*"),r=new RegExp(e,_String(t)).test(n)),r}function mixInZeroWidthUnicode(e){return split(e,"").join($zeroWidthCode)}function forEachKvPair(e,n){var t,r={},i=-1;for(t in e)i++,r[t]=n(e[t],t,i);return r}function getSortList(e){return e.map(function(e,n){return{value:e,index:n}})}function getSortIndex(e,t){var n=getSortList(e),r=getSortList(e);return r.sort(function(e,n){return t(e.value,n.value)}),n.map(function(n){return r.findIndex(function(e){return n.index===e.index})})}function sortWithIndex(e,n){for(var t=[],r=0;r<e.length;r++)t[r]=e[n[r]];return t}function getRatio(e,n){return 0===e||isNull(e)?0:0===n||isNull(n)?1:e/n}function difference(e,t,r){var i=[];return e.forEach(function(n){t.some(function(e){return r(e,n)})||i.push(n)}),t.forEach(function(n){e.some(function(e){return r(e,n)})||i.some(function(e){return r(e,n)})||i.push(n)}),i}function defualtFormatter(e,n,t){return isNull(n)?e:(e=n,t?t(e):e)}function hpObjectKeys(e){return Object.keys(e)}var AVG_FIELD="sys-row-avg";function getUniqId(e,n){var t=[];return isArray(e)?e.forEach(function(e){t.push(n[e])}):t.push(n[e]),t.join("→")}function _rowToColumn(e,n){var u={},t=n.colField;if(!isNull(t)&&e.length){var i=n.cellSummary;if(e.forEach(function(e){var n=e[t];u[n]=u[n]||{data:[],summary:0,_collect:[]},u[n].data.push(e),i&&(e=e[i.numerator[0]],u[n].summary+=e,u[n]._collect.push(e))}),!isNull(i)){var r,a,o;for(r in u)!function(e){var n=u[e],t=1,r=i.denominator;if(r)if(isNumber(r))t=r;else switch(r[1]){case"length":t=n.data.map(function(e){return e[r[0]]}).length;break;case"uniqLength":t=uniq(n.data.map(function(e){return e[r[0]]})).length}switch(i.numerator[1]){case"sum":isNull(n.summary)||(n.summary=n.summary/t);break;case"length":n.summary=n._collect.length/t;break;case"uniqLength":n.summary=uniq(n._collect).length/t}}(r);o=a=0,forEachKvPair(u,function(e){a++;e=isNull(e.summary)?0:e.summary;o+=e}),u[AVG_FIELD]={data:[],summary:o/a,_collect:[]},n.colCustom&&forEachKvPair(n.colCustom,function(e,n){var t=c(e.numerator),e=e.denominator?c(e.denominator):1;u[n]={data:[],summary:getRatio(t,e),_collect:[]}})}}return u;function c(a){var o=0,e=hpObjectKeys(u).filter(function(e){var n=[AVG_FIELD].includes(e),e="*"===a[1]||a[1].includes(e);return!n&&e});return isArray(a[1])&&e.sort(function(e,n){return a[1].indexOf(e)-a[1].indexOf(n)}),e.forEach(function(e,n){var t,r,e=u[e],i=0;isNull(a[2])||"value"===a[2]?i=isNull(e.summary)?0:e.summary:"length"===a[2]?(t=a[3])&&(i=e.data.map(function(e){return e[t]}).length):"uniqLength"===a[2]&&(r=a[3])&&(i=uniq(e.data.map(function(e){return e[r]})).length),"sum"===a[0]?o+=i:"max"===a[0]?o=Math.max(o,i):"diff"===a[0]&&(0===n?o=i:o-=i)}),o}}function _groupToList(e,n,t,r){var i,a=[];for(i in e){var o=n===t,u=_groupToList(e[i].child,n,t+1,r);a.push({uidPath:e[i].uidPath,uid:e[i].uid,data:e[i].data,_columnRiseRatio:{},_columnTotal:{},_columnProportion:{},_columns:_rowToColumn(e[i].data,r),isLeaf:o,children:u})}return a}function deepGroup(e,u){var n={},c=0;!function l(e,n,t){for(var r=0;r<n.length;r++){var i=n[r],a=getUniqId(u.path[c].field,i);e[a]=e[a]||{uidPath:t.concat(a),uid:a,data:[],child:{}},e[a].data.push(i)}if(c<u.path.length-1)for(var o in c++,e)l(e[o].child,e[o].data,e[o].uidPath)}(n,e,[]);var e=_groupToList(n,c,0,u),r=(!function i(e,n){var t;e.sort(null==(t=u.path[n])?void 0:t.sort),e.forEach(function(e){i(e.children,n+1)})}(e,0),!function a(e){e.forEach(function(e){var t={};forEachKvPair(e._columns,function(e,n){e=isNull(e.summary)?0:e.summary;t[n]=t[n]||0,t[n]+=e}),e._columnTotal=t,a(e.children)})}(e),{}),s=(e.forEach(function(t){forEachKvPair(t._columns,function(e,n){r[n]=r[n]||0,r[n]+=t._columnTotal[n]})}),[]);return u.colCustom&&forEachKvPair(u.colCustom,function(e,n){e.riseRatio||s.push(n)}),function t(e){var a={},o={};e.forEach(function(e,i){forEachKvPair(e._columns,function(e,n){var t,r;s.includes(n)||(0<i?isNull(t=e.summary)?o[n]=$undefinedValue:(r=null!=(r=a[n])?r:0,o[n]=getRatio(t-r,r)):o[n]=void 0,a[n]=e.summary)}),e._columnRiseRatio=o,t(e.children)})}(e),function o(e,r){e.forEach(function(e,n){var t={};forEachKvPair(e._columns,function(e,n){t[n]=getRatio(e.summary,r[n])}),e._columnProportion=t,o(e.children,e._columnTotal)})}(e,r),{data:e,total:r}}function listGroup(e,n){var l=deepGroup(e,n);function a(e,n,t,r,i){var a=deepFindItem(l.data,function(e){return 0===difference(e.uidPath,n,function(e,n){return e===n}).length}),o=defualtFormatter("",i);if(a)try{switch(e){case"_columnRiseRatio":case"_columnTotal":case"_columnProportion":var u=a[e][t];return isNull(u)?o:r(u);default:var c=a[e][t].summary;return isNull(c)?o:r(c,a[e][t].data)}}catch(s){return o}return o}function o(e,n,t,r){return a("_columns",e,n,t,r)}function u(e,n,t,r){return a("_columnProportion",e,n,t,r)}return{data:l.data,getCellValue:o,getCellVerticalRiseRatio:function(e,n,t,r){return a("_columnRiseRatio",e,n,t,r)},getCellVerticalTotal:function(e,n,t,r){var i;return"*"===e?isNull(i=l.total[n])?defualtFormatter("",r):t(i):a("_columnTotal",e,n,t,r)},getCellVerticalProportion:u,getRowCellValue:function(n,e,t,r){var i={};return e.forEach(function(e){i[e.id]=o(n,e.field,t,r)}),i},getRowVerticalProportion:function(n,e,t,r){var i={};return e.forEach(function(e){i[e.id]=u(n,e.field,t,r)}),i},getOriginGroupData:function(n,e){var t=deepFindItem(l.data,function(e){return 0===difference(e.uidPath,n,function(e,n){return e===n}).length});return t&&null!=(t=null==(e=t._columns[e])?void 0:e.data)?t:[]},getOriginAllData:function(){return e}}}function union(){for(var e=arguments.length,n=new Array(e),t=0;t<e;t++)n[t]=arguments[t];var r=new Set(n);return Array.from(r)}function isLick0(e){return isNull(e)||0===e}function getRiseRatio(e,n){return isLick0(e)&&isLick0(n)?0:isLick0(e)?1:isLick0(n)?-1:(n-e)/e}function filterWithMove(e,n){for(var t=[],r=0;r<e.length;r++){var i=e[r];n(i,r,e)&&(t.push(i),e.splice(r--,1))}return t}var defaUnits=[[1e4,"万"],[1e8,"亿"]];function shortNumber(e,n,t){for(var r=isNull(t)?defaUnits:t,i=(r.sort(function(e,n){return n[0]-e[0]}),e),a="",o=0;o<r.length;o++){var u=r[o],c=e/u[0];if(1<=Math.abs(c)){i=c,a=u[1];break}}return{value:i,fmtValue:n(i),unit:a}}function zeroWidthNum(e,n){return padStart(e,n,"0")}function formatTime(e){var e=new Date(e),n=e.getFullYear(),t=e.getMonth()+1,r=e.getDate(),i=e.getHours(),a=e.getMinutes(),o=e.getSeconds(),e=e.getMilliseconds();return zeroWidthNum(n,4)+"/"+zeroWidthNum(t,2)+"/"+zeroWidthNum(r,2)+" "+zeroWidthNum(i,2)+":"+zeroWidthNum(a,2)+":"+zeroWidthNum(o,2)+":"+zeroWidthNum(e,3)}function countCol(e){var n=0;return isArray(e.children)?e.children.forEach(function(e){n+=countCol(e)}):n=1,n}function deepParseInfo(e){return main(e,"children",function(e){return{field:e.field,title:e.title,count:countCol(e)}})}function createHeaderRowData(e,i,a,o){return i[a]||(i[a]=[]),o-=1,e.forEach(function(e){var n=o+1,t=(o=n+e.count-1)-n+1,t={colStart:n,colEnd:o,colSpan:t,count:e.count,field:e.field,title:e.title,rowSpan:1};i[a][n]=t;for(var r=1;r<e.count;r++)i[a][n+r]=void 0;isArray(e.children)&&0<e.children.length&&createHeaderRowData(e.children,i,a+1,n)}),i.forEach(function(e){for(var n=0;n<i[0].length;n++)e[n]||(e[n]=void 0)}),i}function getColumnFields(e){for(var t=[],n=e.length-1;0<=n;n--)e[n].forEach(function(e,n){e&&e.field&&isNull(t[n])&&(t[n]=e.field)});return t}function setRowSpan(i){i.forEach(function(e,t){e.forEach(function(e,n){e&&(e.rowSpan=function(e,n){for(var t,r=0;e<i.length&&(null==i||null==(t=i[e])||!t[n]);e++)r++;return r}(t+1,n)+1)})})}function parseTreeToTableHeader(e){e=createHeaderRowData(deepParseInfo(e),[],0,0);return setRowSpan(e),{columns:getColumnFields(e),data:e}}var ConnectEcharts=function(){function e(){this._list={}}var n=e.prototype;return n._resetGroupClickXAxisCategory=function(i){i.forEach(function(n){clearTimeout(n.timer_01),n.instence.off("click",n.onAxxisSeriesClick),n.instence.off("click",n.onAxxisCategoryClick),n.onAxxisCategoryClick=function(e){var t=e.tickIndex,r=!1!==e.needEmit;clearTimeout(n.timer_01),n.timer_01=setTimeout(function(){i.forEach(function(e){var n=cloneEasy(e.instence.getOption());isArray(n.xAxis)&&n.xAxis.length&&r&&e.config&&e.config.onXAxisCtegoryClick&&(n=n.xAxis,e.config.onXAxisCtegoryClick(n.map(function(e){return e.data}),t,e.instence))})},30)},n.onAxxisSeriesClick=function(e){"markLine"!==e.componentType&&null!=n&&n.onAxxisCategoryClick&&n.onAxxisCategoryClick({tickIndex:e.dataIndex})},n.instence.on("click","series",n.onAxxisSeriesClick),n.instence.on("click","xAxis.category",n.onAxxisCategoryClick)})},n.clickXAsisCategory=function(e,n,t){var r,i=!0!==t;for(r in this._list)for(var a=0;a<this._list[r].length;a++){var o=this._list[r][a];o.instence===e&&o.onAxxisCategoryClick&&o.onAxxisCategoryClick({tickIndex:n,needEmit:i})}},n.add=function(e,n){var t=e.group;return t&&(this._list[t]=this._list[t]||[],this._list[t].push({config:n,instence:e,timer_01:-1}),this._resetGroupClickXAxisCategory(this._list[t])),this},n.remove=function(e){if(e)for(var n in this._list)for(var t=0;t<this._list[n].length;t++){var r=this._list[n][t];clearTimeout(r.timer_01),r.instence===e&&(r.instence.off("click",r.onAxxisCategoryClick),this._list[n].splice(t--,1))}},e}(),connectEcharts=new ConnectEcharts;function getPiecesWithIndex(e,r){var i=[];return forEach(e,function(n,e){var t=r.find(function(e){return n>=e.min&&n<e.max});t&&i.push({gte:e,lt:e+1,color:t.color})}),i}function deepFunc(e,n){forEach(e,function(e){isArray(e.children)?deepFunc(e.children,n):n.push(e)})}function treeLeafs(e){var n=[];return deepFunc(e,n),n}var Animate=function(){function e(e){this._timer=void 0,this._passTime=0,this._options=void 0,this._middleData=void 0,this._options=e,this._middleData=cloneEasy(e.to)}var n=e.prototype;return n.start=function(){var n=this,{from:t,to:r,easing:c,duration:s,onChange:i}=this._options,a=(new Date).getTime()-this._passTime;return clearInterval(this._timer),this._timer=setInterval(function(){var o=Math.min((new Date).getTime()-a,s),e=(!function u(r,i,a){function e(e){var n,t;isNumber(i[e])||isNumber(a[e])?(n=_Number(i[e]),t=_Number(a[e]),r[e]=c(o,n,t-n,s)):(isArray(i[e])||isKvPair(i[e]))&&u(r[e],i[e],a[e])}if(isArray(i))for(var n=0;n<i.length;n++)e(n);else if(isKvPair(i))for(var t in r)e(t)}(n._middleData,t,r),o/s);1==e&&(clearInterval(n._timer),o=0),n._passTime=o,i(n._middleData,e)},17),this},n.stop=function(){return clearInterval(this._timer),this},n.dispose=function(){this.stop()},e}();export{Animate,Polling,_Array,_Boolean,_KvPair,_Number,_String,arrayRowToColumn,changeIndex,cloneEasy,connectEcharts,dataPage,deepFindItem,deepFindTreePath,defineEventBus,defualtFormatter,difference,fieldCheck,filterWithMove,floorFixed,forEach,forEachKvPair,forEachTree,formatTime,getLikeNumberRegExp,getPiecesWithIndex,getRandom,getRatio,getRiseRatio,getSortIndex,getType,isArray,isEmpty,isFunction,isFuzzyMatch,isKvPair,isLikeNumber,isNull,isString,listGroup,mapKvPair,main as mapTree,mixInZeroWidthUnicode,padEnd,padStart,param,parseQuery,parseTreeToTableHeader,randomColor,repeatString,roundFixed,shake,shortNumber,sortWithIndex,spanTable,split,thousands,flatArrayToTree as tree,treeLeafs,trim,union,urlToGet,uuid,variableHasValue};
