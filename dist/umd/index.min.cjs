/**  
 * 浏览器工具库 => jUtilsBrowser
 * @update 2024-07-12 22:27:47
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@bestime/utils_base")):"function"==typeof define&&define.amd?define(["exports","@bestime/utils_base"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).jUtilsBrowser={},e.jUtilsBase)}(this,function(e,d){"use strict";let n=0,o,i=!1;const r={};let l;var f={add:function(e,t){return o="HI-"+ ++n,r[o]={start:+new Date,current:0,handler:e,interval:t},i||(clearInterval(l),i=!0,l=setInterval(function(){for(var e in r){const t=r[e];t.current=+new Date,t.current-t.start>=t.interval&&(t.start=t.current,r[e].handler())}},17)),o},remove:function(e){delete r[e],0===Object.keys(r).length&&(i=!1,clearInterval(l),l=undefined)}};function c(e,t){const n=document.createElement("a");n.style.display="none",n.download=t,n.setAttribute("href",e),n.setAttribute("target","_blank"),n.setAttribute("download",t),document.body.appendChild(n),n.click(),n.remove()}const u=void 0,s=decodeURIComponent,a=window,h=document.getElementsByTagName("head")[0];const m={};function p(n,o){const i=[];let r=0;for(let t=0;t<n.length;t++)g(n[t],function(e){i[t]=e,++r===n.length&&o.apply(u,i)})}function g(e,t){var n=e.dependencies&&e.dependencies.length,o=e["with"]&&e["with"].length;m[e.url]||(m[e.url]={count:0,dependencies:!n,"with":!o,complete:!1,create:!1,url:e.url});const i=m[e.url];function r(){return a[e.module]}function l(){i.complete&&i.dependencies&&i["with"]&&(e.module?t(r()):t())}if(i.count++,!i.dependencies&&n)i.dependencies=!0,p(e.dependencies,function(){g(e,t)});else if(!i["with"]&&o)i["with"]=!0,p(e["with"].concat(e),l);else if(i.create)d.variableHasValue(function(){return i.complete},l,300);else{i.create=!0;var n=e.type,o=e.url,c=function(){i.complete=!0,e.interceptor&&e.interceptor(r()),l()},u=e.attribute;if(h){let e;if("js"===n?(e=document.createElement("script")).src=o:((e=document.createElement("link")).setAttribute("rel","stylesheet"),e.href=o),u)for(var s in u)e.setAttribute(s,u[s]);e.onload=e.onerror=c,h.appendChild(e)}}}function v(e,t){(e instanceof Array?p:g)(e,t)}function t(e,t,n){var o;o=t,t=o=d.isString(o)?o:JSON.stringify(o);let i=e+"="+encodeURI(t)+";path=/;";"number"==typeof n&&((o=new Date).setTime(o.getTime()+n),i+="expires="+o.toUTCString()),document.cookie=i}function b(t,e){d.isArray(e)?d.forEach(e,function(e){t.classList.remove(e)}):t.classList.remove(e)}function w(t,e){d.isArray(e)?d.forEach(e,function(e){t.classList.add(e)}):t.classList.add(e)}var S=a.navigator.userAgent,S={isChrome:/Chrome/.test(S),isIPhone:/iPhone/.test(S)};const y=e=>{};e.addClass=w,e.browser=S,e.createXLSX=async function(n){const e=d.cloneEasy(n.header),o=document.createElement("table"),i=function s(t,n){n=d.isNull(n)?1:n;for(let e=0;e<t.length;e++){var o=t[e];d.isNull(o.children)||(o=s(o.children,n+1),n=Math.max(n,o))}return n}(n.header);function r(l,c){const u=[];return function s(t,n,o){for(let e=0;e<n.length;e++){var i,r=n[e].children;if(t===l){let e=o;n.forEach(function(t){var n,o=e,i=e=function c(t,e){return e&&(t+=e.length-1,e.forEach(function(e){t=c(t,e.children)})),t}(e,t.children);e++;for(let e=0;e<=i-o;e++){var r=e+o,l=0===e?i:r;u[r]={title:t.title,field:t.field,colStart:r,colEnd:l,colSpan:(n=t,r=r,l=l,d.isNull(n.colSpan)?!n.children||n.children.length<=1?1:0==(n=l-r)?n:1+n:n.colSpan)}}})}else r&&t<l&&(i=c?.[e+o]?.colStart??0,s(t+1,r,i))}}(1,e,0),u}const l=[];!function a(e,t){e<=i&&(t=r(e,t),l.push(t),a(e+1,t))}(1),l.forEach(function(e,n){e.forEach(function(e,t){e&&(e.rowSpan=function(e,t){let n=0;for(;e<l.length&&!l?.[e]?.[t];e++)n++;return n}(n+1,t)+1)})});var t=l.map(function(e){return`<tr>${e.map(function(e){if(e&&0!==e.colSpan)return`<td align="center" rowSpan="${e.rowSpan}" colSpan="${e.colSpan}">${e?.title}</td>`}).join("")}</tr>`}).join("");const c=function(){const n=[];for(let e=l.length-1;0<=e;e--)l[e].forEach(function(e,t){e&&e.field&&d.isNull(n[t])&&(n[t]=e.field)});return n}();var u=n.body.map(function(o){return`<tr>${c.map(function(e){var t=o.$colField?.[e]??1,n=o.$rowSpan?.[e]??1;if(0!==t&&0!==n)return`<td colSpan="${t}" rowSpan="${n}">${o[e]}</td>`}).filter(function(e){return!d.isNull(e)}).join("")}</tr>`}).join("");return o.innerHTML=`<thead>${t}</thead><tbody>${u}</tbody>`,o.setAttribute("border","1"),o.setAttribute("cellspacing","0"),o.setAttribute("cellpadding","0"),v({type:"js",url:n.pluginUrl,module:"XLSX",attribute:{type:"module"}},function(e){console.log("headFeilds",l,c,n.body);var t=e.utils.table_to_book(o);e.writeFile(t,"Report.xlsx")}),o},e.downloadFileByArrayBuffer=function(e,t){const n=a.URL;c(e=n.createObjectURL(new Blob([e])),t),n.revokeObjectURL(e),undefined},e.downloadFileByUrl=c,e.fullScreen=function(e,t,n){if(t){t=e;e=n;const o=e||y;t.requestFullscreen?t.requestFullscreen():t.webkitRequestFullScreen?t.webkitRequestFullScreen():t.mozRequestFullScreen?t.mozRequestFullScreen():t.msRequestFullscreen&&t.msRequestFullscreen(),o(!0)}else{e=n;const i=e||y,r=document;document.exitFullscreen?document.exitFullscreen().then(function(){i(!0)})["catch"](function(){i(!1)}):r.webkitCancelFullScreen?(r.webkitCancelFullScreen(),i(!0)):r.mozCancelFullScreen?(r.mozCancelFullScreen(),i(!0)):r.msExitFullscreen&&(r.msExitFullscreen(),i(!0))}},e.getCookie=function(e,t){t=t||document.cookie;let o="";return t.replace(new RegExp("(^|;\\s?)"+e+"=(.*?)($|(;\\s?))"),function(e,t,n){o=s(n)}),o},e.getJsFileBaseUrl=function(e){e=e||0;for(var t="/[^/]*",n=document.scripts,o=0;o<e;o++)t+=t;return n[n.length-1].src.replace(new RegExp(t+"$"),"")},e.getRatio=function(){return window.devicePixelRatio||1},e.getRelativePos=function(e){var t=e.getBoundingClientRect();return{x:t.left,y:t.top,height:e.offsetHeight,width:e.offsetWidth,clientWidth:e.clientWidth,clientHeight:e.clientHeight}},e.getStorage=function(e){return e=localStorage.getItem(e),d.defaultValue(e,"")},e.getWindowSize=function(){return{width:document.documentElement.clientWidth||document.body.clientWidth||window.innerWidth||0,height:document.documentElement.clientHeight||document.body.clientHeight||window.innerHeight||0}},e.libraryFile=v,e.observeDomResize=function(n,o,i,e){let r=[0,0,!1],l=[0,0,!1],c=[0,0,!1],u=[0,0,!1];const t=f.add(s,e=e||500);function s(){if(document.body.contains(n)){let e=!1;var t;i?.includes("position")&&(t=n.getBoundingClientRect(),c[0]=t.left,c[2]=c[0]!==c[1],u[0]=t.top,u[2]=u[0]!==u[1]),r[0]=n.offsetWidth,r[2]=r[0]!==r[1],l[0]=n.offsetHeight,l[2]=l[0]!==l[1],r[2]&&(r[1]=r[0],i?.includes("width")&&(e=!0)),l[2]&&(l[1]=l[0],i?.includes("height")&&(e=!0)),(u[2]||c[2])&&(u[1]=u[0],c[1]=c[0],i?.includes("position")&&(e=!0)),i&&0!==i.length||(r[2]||l[2]||u[2]||c[2])&&(e=!0),e&&o(n)}else a()}function a(){f.remove(t),r=undefined,l=undefined}return s(),a},e.observeDomScroll=function(n,e){const o=d._KvPair(e),i=d._Number(o.offetY);let r=!1,l=0;function t(){if(r)return console.log("滚动中",r);var e=n.scrollTop,t=e-l;l=e,0!=t?t<0&&o.onTop&&e<=0+i?(r=!0,o.onTop(function(){r=!1})):0<t&&o.onBottom&&e>=n.scrollHeight-n.offsetHeight-i?(r=!0,o.onBottom(function(){r=!1})):r=!1:(r=!1,console.log("未处理"))}return n.addEventListener("scroll",t),{dispose:function(){n.removeEventListener("scroll",t)}}},e.observeMouseWheel=function(e,n,o){function t(e){let t;if(t=e.wheelDelta?0<e.wheelDelta?1:-1:e.detail<0?1:-1,n(t),o)return e.preventDefault&&e.preventDefault(),!1}return e.addEventListener("mousewheel",t),e.addEventListener("DOMMouseScroll",t),{dispose:function(){e.removeEventListener("mousewheel",t),e.removeEventListener("DOMMouseScroll",t)}}},e.prevent=function(e,t,n){e=e||a.event,n=!1!==n,(t=!1!==t)&&a.event?a.event.cancelBubble=!0:e.stopPropagation(),n&&a.event?a.event.returnValue=!1:e.preventDefault()},e.removeClass=b,e.removeCookie=function(e){t(e,"",-1)},e.removeElement=function(e){e.parentNode&&e.parentNode.removeChild(e)},e.removeStorage=function(e){localStorage.removeItem(e)},e.replaceClass=function(e,t,n){b(e,t),w(e,n)},e.setCookie=t,e.setStorage=function(e,t){localStorage.setItem(e,(e=t,e=d.isString(e)?e:JSON.stringify(e)))},e.toggleClass=function(t,e){d.isArray(e)?d.forEach(e,function(e){t.classList.toggle(e)}):t.classList.toggle(e)}});
